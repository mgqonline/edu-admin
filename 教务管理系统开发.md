培训学校教务管理系统开发文档
一、项目概述
1.1 项目目标
构建一套覆盖培训学校全业务流程的教务管理系统，实现学员管理、课程教学、排课排班、考勤统计、财务核算等核心功能，同时支持管理后台与微信移动端协同，提升教务效率与服务体验。
1.2 业务范围
涵盖校区管理、学员全生命周期管理、班课 / 一对一课程管理、智能排课（批量 + 微调）、教师课时费核算、学员签到统计等业务场景，适配培训学校标准化与个性化管理需求。
1.3 技术栈说明
模块	技术选型	说明
管理后端	SpringBoot 2.7.x + JDK 8	提供核心业务接口，支持多模块拆分
微信端 API	SpringBoot 2.7.x + JDK 8	独立接口模块，处理微信端请求
管理后台前端	Vue 2.x + Ant Design Vue	后台管理系统，支持复杂表单与数据可视化
微信移动端	微信小程序 + 云函数（可选）	学员 / 教师端轻量化操作，依赖微信生态
数据库	MySQL 8.0	存储业务数据，支持事务与索引优化
缓存	Redis 6.x	缓存课表、签到状态等高频访问数据
文件存储	阿里云 OSS（或本地存储）	存储学员照片、合同、报表等文件
二、系统架构设计
2.1 整体架构
plaintext
┌─────────────────┐      ┌─────────────────────────────────────┐
│   客户端层       │      │             服务端层                │
│  ┌─────────────┐ │      │  ┌──────────┐  ┌────────────────┐   │
│  │ 管理后台(Vue)│◄┼──────┼─►│API网关   │──┤权限认证中心    │   │
│  └─────────────┘ │      │  └────┬─────┘  └────────────────┘   │
│  ┌─────────────┐ │      │       │                             │
│  │ 微信小程序   │◄┼──────┼───────┼─────────┐                 │
│  └─────────────┘ │      │       │         │                 │
└─────────────────┘      │       ▼         ▼                 │
                         │  ┌──────────┐  ┌────────────────┐   │
                         │  │业务服务模块│  │数据访问层(MyBatis)│
                         │  └────┬─────┘  └────────┬───────┘   │
                         │       │                 │           │
                         │       ▼                 ▼           │
                         │  ┌──────────┐  ┌────────────────┐   │
                         │  │MySQL数据库│  │Redis缓存/文件存储│   │
                         │  └──────────┘  └────────────────┘   │
                         └─────────────────────────────────────┘
2.2 后端模块拆分
plaintext
edu-admin-backend/
├── common/                # 通用模块（工具类、异常处理、常量）
├── system/                # 系统管理（用户、角色、权限、字典）
├── student/               # 学员管理模块（档案、报名、续费）
├── course/                # 课程管理模块（课程、班级、教材）
├── scheduling/            # 排课管理模块（批量排课、微调、课表）
├── teacher/               # 教师管理模块（信息、课时费、考勤）
├── finance/               # 财务管理模块（收费、退费、薪资核算）
├── wechat-api/            # 微信端接口模块（独立部署或集成）
├── report/                # 报表统计模块（数据可视化、导出）
└── attendance/            # 签到统计模块（核心新增，处理签到逻辑）
三、核心功能模块设计
3.1 基础信息管理模块
3.1.1 校区管理
接口：
POST /api/campus/save：新增 / 编辑校区
GET /api/campus/list：校区列表查询
数据字段：校区 ID、名称、地址、负责人 ID、联系电话、状态（启用 / 禁用）
3.1.2 人员与权限管理
用户管理：支持教职工信息 CRUD，关联角色
权限控制：基于 RBAC 模型，支持按钮级权限（如 “排课编辑权限”“退费审批权限”）
接口：
POST /api/user/save：用户信息维护
GET /api/role/permission：角色权限查询
3.5 学员签到与统计模块（详细功能实现逻辑）
3.5.1 签到核心流程设计
签到触发条件
班课：课时开始前 30 分钟至结束后 10 分钟（可配置）为签到有效期
一对一：教师点击 “开始授课” 后，学员 / 教师需在 5 分钟内完成签到确认
签到方式与逻辑
场景	签到入口	操作流程	异常处理
班课	教师端（管理后台 / 小程序）	教师发起签到 → 系统生成临时签到码（有效期 10 分钟） → 学员扫码 / 教师点名勾选 → 提交签到记录 → 系统校验并更新状态	超时未签到：自动标记 “缺勤”；重复签到：提示 “已完成签到，无需重复操作”
一对一	师生双方小程序	教师点击 “开始授课” → 系统推送签到提醒给学员 → 学员确认签到 → 教师确认签到 → 双方完成后标记 “已签到”	单方未确认：10 分钟后系统提示 “签到超时”，需教师手动标记 “已完成” 或 “缺勤”
签到状态定义
0：未签到（初始状态）
1：已签到（正常签到）
2：迟到（签到时间晚于课时开始时间）
3：早退（教师标记学员提前离开）
4：缺勤（有效期内未签到）
3.5.2 签到数据存储与关联逻辑
核心数据表设计
表名	作用	核心字段
sign_record	签到主记录	id, schedule_id（课时 ID）, class_id（班级 ID）, sign_time（签到时间）, status（整体签到状态：未开始 / 进行中 / 已结束）
student_sign_rel	学员 - 签到关联表	id, sign_record_id, student_id, sign_type（1 - 已签 / 2 - 迟到 / 3 - 早退 / 4 - 缺勤）, sign_time（学员签到时间）
sign_config	签到规则配置表	id, campus_id（校区 ID）, checkin_valid_start（提前多久可签到，单位分钟）, checkin_valid_end（延后多久可签到）
数据关联逻辑
1 个课时（schedule_info）对应 1 条签到主记录（sign_record）
1 条签到主记录关联 N 条学员签到记录（student_sign_rel，N = 班级学员数）
签到完成后，自动关联学员剩余课时计算（student_class_rel中的remaining_hours字段扣减 1）
3.5.3 统计分析功能实现
实时统计（课时结束后自动生成）
单课时统计：
计算公式：
出勤率 =（实到人数 / 应到人数）× 100%
实到人数 = 状态为 “已签到”+“迟到” 的学员数
应到人数 = 班级当前在读学员数（排除已请假 / 休学学员）
数据存储：结果写入schedule_stat表，关联课时 ID
学员明细统计：
记录每个学员的签到状态、签到时间，支持按 “缺勤”“迟到” 筛选
接口：GET /api/attendance/student/detail?scheduleId=xxx
累计统计（按周期 / 维度聚合）
学员维度：
统计某学员在指定周期内的总课时数、已完成课时数、缺勤次数、迟到次数
实现逻辑：按student_id分组，聚合student_sign_rel中指定时间范围的记录
接口：GET /api/attendance/student/stats?studentId=xxx&startDate=xxx&endDate=xxx
班级维度：
统计某班级的平均出勤率、每月缺勤 TOP3 学员
实现逻辑：按class_id分组，计算每个课时的出勤率后求平均值
接口：GET /api/attendance/class/stats?classId=xxx&month=xxx
教师维度：
统计教师所带班级的整体出勤率（辅助教学评估）
实现逻辑：关联class_info（教师与班级关联）和schedule_stat（课时出勤率）
接口：GET /api/attendance/teacher/stats?teacherId=xxx&startDate=xxx
3.5.4 异常处理与通知机制
签到异常场景处理
漏签补签：支持教师在课时结束后 24 小时内发起补签（需填写原因），补签后状态更新为 “补签”（不影响出勤率计算，但标记记录）
重复签到：前端拦截重复提交，后端校验student_sign_rel中是否已有该学员的有效记录
数据不一致：定时任务（每日凌晨）比对schedule_info与sign_record，检查未生成签到记录的课时并告警
通知触发逻辑
课前提醒：课时开始前 15 分钟，向教师推送 “即将上课，请准备签到”，向学员推送 “即将上课，记得签到”
缺勤通知：课时结束后 30 分钟，向缺勤学员的监护人推送 “学员 XX 在 XX 课时未签到，已记录缺勤”
统计通知：每周一向班主任推送 “上周班级出勤率报表”
3.5.5 前端展示与交互
管理后台签到页面
vue
<template>
  <div class="attendance-container">
    <!-- 课时选择器 -->
    <a-select v-model="scheduleId" @change="loadSignData">
      <a-select-option v-for="s in scheduleList" :key="s.id">{{ s.className }} {{ s.date }} {{ s.startTime }}</a-select-option>
    </a-select>

    <!-- 签到操作区（教师视角） -->
    <div v-if="isTeacher">
      <a-button type="primary" @click="startSign" v-if="!signStarted">发起签到</a-button>
      <a-input v-if="signStarted" :value="signCode" disabled placeholder="签到码"></a-input>
    </div>

    <!-- 学员签到列表 -->
    <a-table :data-source="studentSignList" :columns="columns">
      <template #status="record">
        <a-tag color="green" v-if="record.signType === 1">已签到</a-tag>
        <a-tag color="orange" v-if="record.signType === 2">迟到</a-tag>
        <a-tag color="red" v-if="record.signType === 4">缺勤</a-tag>
      </template>
      <template #action="record" v-if="isTeacher">
        <a-button @click="handleEditSign(record)">修改状态</a-button>
      </template>
    </a-table>

    <!-- 统计卡片 -->
    <a-row :gutter="16" style="margin-top: 20px;">
      <a-col :span="6">
        <a-statistic title="应到人数" :value="totalStudents" />
      </a-col>
      <a-col :span="6">
        <a-statistic title="实到人数" :value="arrivedStudents" />
      </a-col>
      <a-col :span="6">
        <a-statistic title="出勤率" :value="attendanceRate" suffix="%" />
      </a-col>
    </a-row>
  </div>
</template>
微信小程序签到页面
学员端：展示当前待签到课时，点击 “扫码签到” 调用微信扫码 API，或直接点击 “确认签到”（一对一场景）
教师端：展示待签到班级列表，点击 “发起签到” 生成二维码，支持手动勾选学员签到状态
3.2 课程与班级管理模块
3.2.1 课程管理
功能：维护课程基础信息，区分班课 / 一对一类型
数据字段：课程 ID、名称、类别（K12 / 职业教育）、类型（班课 / 一对一）、课时数、单价、适合年龄段、大纲 URL
接口：
POST /api/course/save：课程信息维护
GET /api/course/detail/{id}：课程详情查询
3.2.2 班级管理
班课班级：关联固定课程、教师、教室，设置人数上限
一对一班级：仅关联单个学员，灵活匹配教师
接口：
POST /api/class/save：班级创建 / 编辑
GET /api/class/students/{classId}：班级学员列表
3.3 排课管理模块（核心）
3.3.1 批量排课功能
按月 / 按周排课：
输入参数：班级 ID、排课周期（月份 / 周数）、上课日（如每周一、三）、课时时间（如 19:00-21:00）
自动生成课时列表，校验教师 / 教室冲突
接口：
POST /api/schedule/batch/month：按月批量排课
POST /api/schedule/batch/week：按周批量排课
3.3.2 单课时微调功能
调整项：教师、时间、课时长度、科目、课时金额
冲突校验：调整后自动检查教师 / 教室时间重叠
接口：
POST /api/schedule/adjust：单课时调整
GET /api/schedule/conflict/check：冲突检查
3.3.3 课表展示
多维度查询：按班级、教师、学员、教室
接口：GET /api/schedule/list（支持多条件筛选）
3.4 教师课时费管理模块
3.4.1 课时费规则配置
基础规则：按教师等级、课程类型、班级规模设置
特殊规则：节假日补贴、代课奖励、阶梯奖励
接口：
POST /api/teacher/fee/rule/save：规则配置
GET /api/teacher/fee/calculate：实时计算某课时费用
3.4.2 课时费核算
关联签到记录（仅 “已完成” 课时计入）
支持按教师 / 月份导出明细
接口：
GET /api/teacher/fee/stats：课时费统计
POST /api/teacher/fee/export：导出明细
3.6 微信移动端功能
3.6.1 学员端
课表查询、请假申请、签到确认、剩余课时查询
接口：GET /wechat/api/student/schedule、POST /wechat/api/student/leave
3.6.2 教师端
授课提醒、发起签到、课时费查询、调课申请
接口：GET /wechat/api/teacher/schedule、POST /wechat/api/teacher/sign
四、数据库设计（核心表）
表名	说明	核心字段
sys_user	系统用户表	user_id, username, role_id, status
base_campus	校区表	campus_id, name, address, leader_id
course_info	课程信息表	course_id, name, type (班课 / 一对一), price
class_info	班级表	class_id, course_id, teacher_id, campus_id, start_date
schedule_info	课时表	schedule_id, class_id, teacher_id, date, start_time, end_time, fee_amount
student_info	学员表	student_id, name, guardian_phone, status
student_class_rel	学员班级关联表	id, student_id, class_id, enroll_time, remaining_hours
sign_record	签到主记录表	id, schedule_id, class_id, sign_start_time, sign_end_time, status (0 - 未开始 / 1 - 进行中 / 2 - 已结束)
student_sign_rel	学员签到关联表	id, sign_record_id, student_id, sign_type (1 - 已签 / 2 - 迟到 / 3 - 早退 / 4 - 缺勤), sign_time
sign_config	签到规则配置表	id, campus_id, checkin_valid_start, checkin_valid_end
schedule_stat	课时统计报表	id, schedule_id, total_students, arrived_students, attendance_rate
teacher_fee_rule	课时费规则表	id, teacher_level, course_type, base_fee, subsidy_rule
五、接口规范
请求格式：
所有接口采用 RESTful 风格
入参 / 出参统一为 JSON 格式
分页参数：pageNum（默认 1）、pageSize（默认 10）
响应格式：
json
{
  "code": 200,        // 200成功，其他为错误码
  "msg": "操作成功",   // 提示信息
  "data": { ... }     // 业务数据
}
权限校验：
管理后台接口需在请求头携带Authorization: Bearer {token}
微信端接口通过openid与session_key验证身份
六、部署方案
开发环境：
后端：本地 SpringBoot 启动，连接测试库
前端：npm run serve启动开发服务器
微信端：微信开发者工具调试
生产环境：
后端：打包为 Jar，部署至 Linux 服务器（使用 Jenkins 自动化部署）
前端：npm run build生成静态文件，部署至 Nginx
数据库：主从架构，定期备份
监控：集成 SpringBoot Admin 监控服务状态
七、迭代计划
阶段	功能范围	预计周期
第一阶段	基础信息 + 课程班级 + 学员管理	2 周
第二阶段	排课管理（批量 + 微调）+ 课时费配置	3 周
第三阶段	签到统计 + 微信端基础功能	2 周
第四阶段	财务核算 + 报表统计 + 系统优化	3 周
附录：核心业务流程图
学员签到流程：
plaintext
课时开始前 → 教师发起签到 → 生成签到码/名单 → 学员签到 → 系统记录状态 → 课时结束 → 自动计算出勤率 → 推送异常通知
批量排课流程：
plaintext
选择班级 → 配置排课周期 → 系统生成课时 → 冲突检查 → 确认生成
课时费核算流程：
plaintext
课时完成签到 → 触发费用计算（匹配规则） → 生成课时费明细 → 薪资汇总

