import{n as i,_ as s}from"./index-67337038.js";function r(a){if(!a)return"";if(typeof a=="string"&&/^\d{4}-\d{2}-\d{2}$/.test(a))return a;const t=n=>String(n).padStart(2,"0"),e=new Date(a);return e.getFullYear()+"-"+t(e.getMonth()+1)+"-"+t(e.getDate())}const d={name:"ReportFinance",components:{V2SimpleDate:()=>s(()=>import("./V2SimpleDate-11821f76.js"),["assets/V2SimpleDate-11821f76.js","assets/index-67337038.js","assets/index-f5f188af.css","assets/V2SimpleDate-9b3aafb8.css"])},data(){return{revRange:"month",loadingRev:!1,revPoints:[],loadingShare:!1,courseShare:[],rStart:"",rEnd:"",loadingRefund:!1,refundPoints:[],pStart:"",pEnd:"",loadingProfit:!1,profit:{_only:1,revenue:0,refunds:0,teacherFees:0,profit:0}}},computed:{columnsRev(){return[{title:this.revRange==="quarter"?"季度":"月份",dataIndex:this.revRange==="quarter"?"quarter":"month",key:"k"},{title:"金额",dataIndex:"amount",key:"amount"}]},columnsShare(){return[{title:"课程",dataIndex:"courseName",key:"courseName"},{title:"金额",dataIndex:"amount",key:"amount"},{title:"占比(%)",dataIndex:"ratio",key:"ratio"}]},columnsRefund(){return[{title:"月份",dataIndex:"month",key:"month"},{title:"退费金额",dataIndex:"amount",key:"amount"}]},columnsProfit(){return[{title:"总营收",dataIndex:"revenue",key:"revenue"},{title:"退费",dataIndex:"refunds",key:"refunds"},{title:"教师课时费",dataIndex:"teacherFees",key:"teacherFees"},{title:"净利润",dataIndex:"profit",key:"profit"}]}},methods:{async loadRevenue(){this.loadingRev=!0;try{const t=await(await fetch(`/api/report/finance/revenue-trend?range=${this.revRange}`)).json(),e=t&&t.code===200?t.data&&t.data.points||[]:[];this.revPoints=e.map((n,o)=>({...n,_k:o}))}finally{this.loadingRev=!1}},async loadCourseShare(){this.loadingShare=!0;try{const t=await(await fetch("/api/report/finance/course-income-share")).json();this.courseShare=t&&t.code===200?t.data||[]:[]}finally{this.loadingShare=!1}},async loadRefund(){this.loadingRefund=!0;try{const a=new URLSearchParams;this.rStart&&a.append("startDate",r(this.rStart)),this.rEnd&&a.append("endDate",r(this.rEnd));const e=await(await fetch("/api/report/finance/refund-stats?"+a.toString())).json(),n=e&&e.code===200?e.data&&e.data.points||[]:[];this.refundPoints=n}finally{this.loadingRefund=!1}},async loadProfit(){this.loadingProfit=!0;try{const a=new URLSearchParams;this.pStart&&a.append("startDate",r(this.pStart)),this.pEnd&&a.append("endDate",r(this.pEnd));const e=await(await fetch("/api/report/finance/net-profit?"+a.toString())).json();if(e&&e.code===200){const n=e.data||{};this.profit={_only:1,revenue:n.revenue||0,refunds:n.refunds||0,teacherFees:n.teacherFees||0,profit:n.profit||0}}}finally{this.loadingProfit=!1}},exportRevenue(){window.open(`/api/report/export/revenue-trend.csv?range=${this.revRange}`,"_blank")},exportCourseShare(){window.open("/api/report/export/course-income-share.csv","_blank")},exportRefund(){const a=new URLSearchParams;this.rStart&&a.append("startDate",r(this.rStart)),this.rEnd&&a.append("endDate",r(this.rEnd)),window.open("/api/report/export/refund-stats.csv?"+a.toString(),"_blank")},exportProfit(){const a=new URLSearchParams;this.pStart&&a.append("startDate",r(this.pStart)),this.pEnd&&a.append("endDate",r(this.pEnd)),window.open("/api/report/export/net-profit.csv?"+a.toString(),"_blank")}},mounted(){this.loadRevenue(),this.loadCourseShare(),this.loadRefund(),this.loadProfit()}};var l=function(){var t=this,e=t._self._c;return e("div",{staticStyle:{background:"#fff",padding:"16px"}},[e("h2",[t._v("财务报表")]),e("h3",[t._v("营收趋势")]),e("a-space",{staticStyle:{"margin-bottom":"8px"}},[e("a-select",{staticStyle:{width:"160px"},model:{value:t.revRange,callback:function(n){t.revRange=n},expression:"revRange"}},[e("a-select-option",{attrs:{value:"month"}},[t._v("最近6个月")]),e("a-select-option",{attrs:{value:"quarter"}},[t._v("最近4个季度")])],1),e("a-button",{attrs:{type:"primary",loading:t.loadingRev},on:{click:t.loadRevenue}},[t._v("加载营收趋势")]),e("a-button",{attrs:{disabled:t.loadingRev},on:{click:t.exportRevenue}},[t._v("导出营收CSV")])],1),e("a-table",{attrs:{"data-source":t.revPoints,columns:t.columnsRev,pagination:!1,rowKey:"_k"}}),e("h3",{staticStyle:{"margin-top":"24px"}},[t._v("课程收入占比")]),e("a-space",{staticStyle:{"margin-bottom":"8px"}},[e("a-button",{attrs:{type:"primary",loading:t.loadingShare},on:{click:t.loadCourseShare}},[t._v("加载占比")]),e("a-button",{attrs:{disabled:t.loadingShare},on:{click:t.exportCourseShare}},[t._v("导出占比CSV")])],1),e("a-table",{attrs:{"data-source":t.courseShare,columns:t.columnsShare,pagination:!1,rowKey:"courseId"}}),e("h3",{staticStyle:{"margin-top":"24px"}},[t._v("退费统计")]),e("a-space",{staticStyle:{"margin-bottom":"8px"}},[e("V2SimpleDate",{attrs:{type:"date",format:"YYYY-MM-DD",placeholder:"开始日期"},model:{value:t.rStart,callback:function(n){t.rStart=n},expression:"rStart"}}),e("V2SimpleDate",{attrs:{type:"date",format:"YYYY-MM-DD",placeholder:"结束日期"},model:{value:t.rEnd,callback:function(n){t.rEnd=n},expression:"rEnd"}}),e("a-button",{attrs:{type:"primary",loading:t.loadingRefund},on:{click:t.loadRefund}},[t._v("加载退费")]),e("a-button",{attrs:{disabled:t.loadingRefund},on:{click:t.exportRefund}},[t._v("导出退费CSV")])],1),e("a-table",{attrs:{"data-source":t.refundPoints,columns:t.columnsRefund,pagination:!1,rowKey:"month"}}),e("h3",{staticStyle:{"margin-top":"24px"}},[t._v("净利润")]),e("a-space",{staticStyle:{"margin-bottom":"8px"}},[e("V2SimpleDate",{attrs:{type:"date",format:"YYYY-MM-DD",placeholder:"开始日期"},model:{value:t.pStart,callback:function(n){t.pStart=n},expression:"pStart"}}),e("V2SimpleDate",{attrs:{type:"date",format:"YYYY-MM-DD",placeholder:"结束日期"},model:{value:t.pEnd,callback:function(n){t.pEnd=n},expression:"pEnd"}}),e("a-button",{attrs:{type:"primary",loading:t.loadingProfit},on:{click:t.loadProfit}},[t._v("计算净利润")]),e("a-button",{attrs:{disabled:t.loadingProfit},on:{click:t.exportProfit}},[t._v("导出净利润CSV")])],1),e("a-table",{attrs:{"data-source":[t.profit],columns:t.columnsProfit,pagination:!1,rowKey:"_only"}})],1)},p=[],c=i(d,l,p,!1,null,"11735608",null,null);const f=c.exports;export{f as default};
