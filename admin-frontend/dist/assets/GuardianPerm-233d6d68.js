import{n as r}from"./index-67337038.js";const n={name:"GuardianPerm",data(){return{form:{studentId:null,guardianName:"",guardianPhone:"",relation:""},viewPerms:{schedule:!0,grades:!0,payments:!0},actionPerms:{leave:!1,renew:!1},list:[],pagination:{current:1,pageSize:10,total:0,showSizeChanger:!0,pageSizeOptions:["10","20","50"]},columns:[{title:"ID",dataIndex:"id",key:"id"},{title:"学员ID",dataIndex:"studentId",key:"studentId"},{title:"监护人",dataIndex:"guardianName",key:"guardianName"},{title:"手机号",dataIndex:"guardianPhone",key:"guardianPhone"},{title:"关系",dataIndex:"relation",key:"relation"},{title:"可查看",key:"viewPerms",scopedSlots:{customRender:"viewPerms"}},{title:"可操作",key:"actionPerms",scopedSlots:{customRender:"actionPerms"}}]}},methods:{formatPerms(s){if(!s)return"-";const e={schedule:"课表",grades:"成绩",payments:"缴费",leave:"请假",renew:"续费"},a=Object.keys(s).filter(t=>s[t]);return a.length?a.map(t=>e[t]||t).join("、"):"-"},async save(){if(!this.form.studentId||!this.form.guardianPhone){this.$message&&this.$message.error("请填写学员ID与手机号");return}const s={...this.form,viewPerms:this.viewPerms,actionPerms:this.actionPerms},a=await(await fetch("/api/student/guardian/perm/set",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)})).json();a.code===200?(this.$message&&this.$message.success("保存成功"),this.loadList()):this.$message&&this.$message.error("失败："+(a.msg||"未知错误"))},async loadList(){if(!this.form.studentId){this.$message&&this.$message.info("请先填写学员ID");return}const s=new URLSearchParams;s.append("studentId",String(this.form.studentId)),s.append("page",String(this.pagination.current||1)),s.append("size",String(this.pagination.pageSize||10));const t=(await(await fetch(`/api/student/guardian/perm/list?${s.toString()}`)).json()).data||{};this.list=Array.isArray(t)?t:t.items||[],this.pagination.total=Number(t.total||this.list.length)},onTableChange(s){this.pagination.current=s.current,this.pagination.pageSize=s.pageSize,this.loadList()}}};var i=function(){var e=this,a=e._self._c;return a("div",{staticClass:"guardian-perm"},[a("a-page-header",{attrs:{title:"监护人权限设置","sub-title":"查看与操作权限"}}),a("a-card",{staticStyle:{"margin-bottom":"12px"},attrs:{bordered:"",title:"配置监护人权限"}},[a("a-form",{attrs:{"label-col":{span:6},"wrapper-col":{span:16}}},[a("a-row",{attrs:{gutter:16}},[a("a-col",{attrs:{span:6}},[a("a-form-item",{attrs:{label:"学员ID"}},[a("a-input-number",{staticStyle:{width:"100%"},attrs:{min:1},model:{value:e.form.studentId,callback:function(t){e.$set(e.form,"studentId",t)},expression:"form.studentId"}})],1)],1),a("a-col",{attrs:{span:6}},[a("a-form-item",{attrs:{label:"姓名"}},[a("a-input",{model:{value:e.form.guardianName,callback:function(t){e.$set(e.form,"guardianName",t)},expression:"form.guardianName"}})],1)],1),a("a-col",{attrs:{span:6}},[a("a-form-item",{attrs:{label:"手机号"}},[a("a-input",{model:{value:e.form.guardianPhone,callback:function(t){e.$set(e.form,"guardianPhone",t)},expression:"form.guardianPhone"}})],1)],1),a("a-col",{attrs:{span:6}},[a("a-form-item",{attrs:{label:"关系"}},[a("a-input",{attrs:{placeholder:"父亲/母亲/亲属"},model:{value:e.form.relation,callback:function(t){e.$set(e.form,"relation",t)},expression:"form.relation"}})],1)],1)],1),a("a-row",{attrs:{gutter:16}},[a("a-col",{attrs:{span:12}},[a("a-card",{attrs:{size:"small",title:"可查看信息",bordered:""}},[a("a-space",{attrs:{direction:"vertical"}},[a("a-checkbox",{model:{value:e.viewPerms.schedule,callback:function(t){e.$set(e.viewPerms,"schedule",t)},expression:"viewPerms.schedule"}},[e._v("课表")]),a("a-checkbox",{model:{value:e.viewPerms.grades,callback:function(t){e.$set(e.viewPerms,"grades",t)},expression:"viewPerms.grades"}},[e._v("成绩")]),a("a-checkbox",{model:{value:e.viewPerms.payments,callback:function(t){e.$set(e.viewPerms,"payments",t)},expression:"viewPerms.payments"}},[e._v("缴费")])],1)],1)],1),a("a-col",{attrs:{span:12}},[a("a-card",{attrs:{size:"small",title:"可操作功能",bordered:""}},[a("a-space",{attrs:{direction:"vertical"}},[a("a-checkbox",{model:{value:e.actionPerms.leave,callback:function(t){e.$set(e.actionPerms,"leave",t)},expression:"actionPerms.leave"}},[e._v("请假")]),a("a-checkbox",{model:{value:e.actionPerms.renew,callback:function(t){e.$set(e.actionPerms,"renew",t)},expression:"actionPerms.renew"}},[e._v("续费")])],1)],1)],1)],1),a("a-form-item",{attrs:{"wrapper-col":{span:16,offset:6}}},[a("a-space",[a("a-button",{attrs:{type:"primary"},on:{click:e.save}},[e._v("保存设置")]),a("a-button",{on:{click:e.loadList}},[e._v("加载列表")])],1)],1)],1)],1),a("a-card",{attrs:{bordered:"",title:"监护人权限列表"}},[a("a-table",{attrs:{"data-source":e.list,columns:e.columns,rowKey:"id",pagination:e.pagination},on:{change:e.onTableChange},scopedSlots:e._u([{key:"viewPerms",fn:function(t){return[e._v(" "+e._s(e.formatPerms(t&&t.record&&t.record.viewPerms))+" ")]}},{key:"actionPerms",fn:function(t){return[e._v(" "+e._s(e.formatPerms(t&&t.record&&t.record.actionPerms))+" ")]}}])})],1)],1)},o=[],l=r(n,i,o,!1,null,"a6911f74",null,null);const m=l.exports;export{m as default};
