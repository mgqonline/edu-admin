import{n as S,h as y}from"./index-67337038.js";const b={name:"ScheduleManage",data(){return{fixedClassMode:!1,fixedClassMeta:{},loading:!1,classOptions:[],teacherOptions:[],subjectOptions:[],classroomOptions:[],hasUnsavedSchedules:!1,weekDayOptions:[{label:"周一",value:1},{label:"周二",value:2},{label:"周三",value:3},{label:"周四",value:4},{label:"周五",value:5},{label:"周六",value:6},{label:"周日",value:7}],calendarMonth:null,calendarMonthStr:"",calendarWeeks:[],selectedDates:[],calendarForm:{classId:null,classType:"1",teacherId:null,classroomId:null,subject:"",durationMinutes:60,startTime:"09:00",endTime:"10:30",fee:100},calendarSchedules:[],calendarColumns:[{title:"班级类型",dataIndex:"classType",key:"classType",scopedSlots:{customRender:"classType"}},{title:"单课课时",dataIndex:"durationMinutes",key:"durationMinutes",scopedSlots:{customRender:"durationMinutes"}},{title:"课时单价",dataIndex:"fee",key:"fee",scopedSlots:{customRender:"fee"}},{title:"日期+时间",dataIndex:"dateTime",key:"dateTime"},{title:"老师",dataIndex:"teacherId",key:"teacherId",scopedSlots:{customRender:"teacher"}},{title:"科目",dataIndex:"subject",key:"subject",scopedSlots:{customRender:"subject"}},{title:"教室",dataIndex:"classroomId",key:"classroomId",scopedSlots:{customRender:"classroom"}},{title:"时间点",dataIndex:"timePoint",key:"timePoint",scopedSlots:{customRender:"timePoint"}},{title:"操作",key:"ops",scopedSlots:{customRender:"ops"}}],editVisible:!1,editForm:{},editingRecord:null}},created(){this.loadClassOptions(),this.loadTeacherOptions(),this.loadSubjectOptions(),this.loadClassroomOptions(),this.initCalendar();const s=this.$route&&this.$route.query||{},t=s.classId!=null?Number(s.classId):null;if(t){this.fixedClassMode=!0,this.fixedClassMeta={classId:t,className:s.className||"",mode:s.mode||""},this.calendarForm.classId=t;const e=String(s.classType||"").trim(),a=String(s.mode||"").trim();this.calendarForm.classType=e||(a==="一对一"?"2":"1"),s.teacherId&&(this.calendarForm.teacherId=Number(s.teacherId)),s.subject&&(this.calendarForm.subject=String(s.subject))}this.syncFeeWithDuration()},watch:{"calendarForm.durationMinutes"(s){this.syncFeeWithDuration()}},methods:{async loadClassroomOptions(){try{const t=await(await fetch("/api/base/classroom/list")).json();this.classroomOptions=t&&t.code===200?t.data||[]:[]}catch{this.classroomOptions=[]}},async loadClassOptions(){try{const s=localStorage.getItem("AUTH_TOKEN")||"",e=await(await fetch("/api/class/list",{headers:s?{Authorization:"Bearer "+s}:void 0})).json();e&&e.code===200&&(this.classOptions=(e.data||[]).map(a=>({id:a.id,name:a.name,mode:a.mode})))}catch{}},async loadTeacherOptions(){try{const s=localStorage.getItem("AUTH_TOKEN")||"",e=await(await fetch("/api/teacher/list",{headers:{Authorization:"Bearer "+s}})).json(),a=e&&e.code===200?e.data||[]:[];this.teacherOptions=Array.isArray(a)?a.map(i=>({id:i.id,name:i.name||i.teacherName||"老师#"+(i.id||"")})):[],!this.calendarForm.teacherId&&this.teacherOptions.length&&(this.calendarForm.teacherId=this.teacherOptions[0].id)}catch{this.teacherOptions=[]}},onClassChange(s){const t=this.classOptions.find(e=>e.id===s);if(t){const e=String(t.mode||"").trim();this.calendarForm.classType=e==="一对一"?"2":"1"}else this.calendarForm.classType||(this.calendarForm.classType="1")},async loadSubjectOptions(){try{const t=await(await fetch("/api/dict/subject/list")).json();if(t&&t.code===200){const e=(t.data||[]).map(a=>({id:a.id,name:a.name||a.subjectName||""})).filter(a=>a.name);this.subjectOptions=e.length?e:[]}}catch{}(!Array.isArray(this.subjectOptions)||!this.subjectOptions.length)&&(this.subjectOptions=[{name:"数学"},{name:"英语"},{name:"语文"},{name:"物理"},{name:"化学"}]),!this.calendarForm.subject&&this.subjectOptions.length&&(this.calendarForm.subject=this.subjectOptions[0].name)},initCalendar(){const s=new Date,t=s.getFullYear(),e=s.getMonth()+1,a=`${t}-${String(e).padStart(2,"0")}`;this.calendarMonthStr=a,this.calendarMonth=y(a,"YYYY-MM"),this.buildCalendarWeeks(a)},onCalendarMonthChange(s,t){const e=t||(s&&typeof s.format=="function"?s.format("YYYY-MM"):"");this.calendarMonth=s,this.calendarMonthStr=e,this.selectedDates=[],this.buildCalendarWeeks(e)},onCalendarMonthInputChange(){const s=this.calendarMonthStr;this.selectedDates=[],this.buildCalendarWeeks(s)},prevMonth(){const[s,t]=(this.calendarMonthStr||"").split("-");let e=Number(s)||new Date().getFullYear(),a=Number(t)||new Date().getMonth()+1;a-=1,a<1&&(a=12,e-=1),this.calendarMonthStr=`${e}-${String(a).padStart(2,"0")}`,this.onCalendarMonthInputChange()},nextMonth(){const[s,t]=(this.calendarMonthStr||"").split("-");let e=Number(s)||new Date().getFullYear(),a=Number(t)||new Date().getMonth()+1;a+=1,a>12&&(a=1,e+=1),this.calendarMonthStr=`${e}-${String(a).padStart(2,"0")}`,this.onCalendarMonthInputChange()},buildCalendarWeeks(s){if(!s){this.calendarWeeks=[];return}const[t,e]=s.split("-"),a=Number(t),i=Number(e),n=new Date(a,i-1,1),r=new Date(a,i,0).getDate(),d=n.getDay()===0?7:n.getDay(),c=[];for(let o=1;o<d;o++)c.push({inMonth:!1});for(let o=1;o<=r;o++){const u=`${a}-${String(i).padStart(2,"0")}-${String(o).padStart(2,"0")}`;c.push({inMonth:!0,dayNum:o,dateStr:u,selected:this.selectedDates.includes(u)})}for(;c.length%7!==0;)c.push({inMonth:!1});const m=[];for(let o=0;o<c.length;o+=7)m.push(c.slice(o,o+7));this.calendarWeeks=m},onCalendarCellClick(s){if(!s||!s.inMonth||!s.dateStr)return;const t=s.dateStr;if(!this._rangeStart)this.selectedDates.includes(t)?this.selectedDates=this.selectedDates.filter(e=>e!==t):(this._rangeStart=t,this.selectedDates=[...this.selectedDates,t]);else{const e=new Date(this._rangeStart),a=new Date(t),i=e<=a?e:a,n=e<=a?a:e,l=[],r=new Date(i);for(;r<=n;)l.push(`${r.getFullYear()}-${String(r.getMonth()+1).padStart(2,"0")}-${String(r.getDate()).padStart(2,"0")}`),r.setDate(r.getDate()+1);const d=Array.from(new Set([...this.selectedDates,...l]));d.sort((c,m)=>new Date(c).getTime()-new Date(m).getTime()),this.selectedDates=d,this._rangeStart=null}this.buildCalendarWeeks(this.calendarMonthStr)},clearSelections(){this.selectedDates=[],this._rangeStart=null,this.calendarSchedules&&this.calendarSchedules.length&&this.hasUnsavedSchedules&&(this.calendarSchedules=[],this.hasUnsavedSchedules=!1,this.$message.success("已清空日期选择并移除未提交的排课数据")),this.buildCalendarWeeks(this.calendarMonthStr)},fmtHHmm(s){if(!s)return"";if(typeof s=="string"){const t=s.trim(),e=/^\d{1,2}:\d{2}$/.test(t)?t:"";if(!e)return"";const[a,i]=e.split(":");return`${String(Number(a)).padStart(2,"0")}:${i}`}if(typeof s.format=="function")try{return s.format("HH:mm")}catch{}try{const t=s.getHours&&s.getHours()||0,e=s.getMinutes&&s.getMinutes()||0;return`${String(t).padStart(2,"0")}:${String(e).padStart(2,"0")}`}catch{return""}},generateCalendarList(){const s=[];if(String(this.calendarForm.classType===void 0||this.calendarForm.classType===null?"":this.calendarForm.classType).trim()||s.push("班级类型"),this.selectedDates.length||s.push("日期"),(!this.calendarForm.startTime||!this.calendarForm.endTime)&&s.push("上课时间"),s.length){this.$message.error("请完整选择："+s.join("、"));return}const e=this.fmtHHmm(this.calendarForm.startTime),a=this.fmtHHmm(this.calendarForm.endTime);if(!e||!a){this.$message.error("请输入有效的起止时间（HH:mm）");return}const[i,n]=e.split(":").map(h=>Number(h)),[l,r]=a.split(":").map(h=>Number(h)),d=i*60+n;if(l*60+r<=d){this.$message.error("结束时间必须晚于开始时间");return}const m=`${e}-${a}`,o=Number(this.calendarForm.durationMinutes)||60,u=Math.round(o/60)*100,p=this.calendarForm.teacherId||this.teacherOptions[0]&&this.teacherOptions[0].id||null,f=this.calendarForm.subject||this.subjectOptions[0]&&this.subjectOptions[0].name||"";this.calendarSchedules=this.selectedDates.map((h,g)=>({key:h+"-"+g,classType:this.calendarForm.classType,classId:this.calendarForm.classId||null,teacherId:p,classroomId:this.calendarForm.classroomId||null,durationMinutes:o,fee:u,subject:f,date:h,timeRange:m,dateTime:`${h} ${e}`,timePoint:e,conflict:!1,status:"正常"})),this.hasUnsavedSchedules=!!this.calendarSchedules.length,console.log(this.calendarSchedules),this.$message.success("已生成排课列表，请检查或提交")},getTimePointOptions(){const s=this.fmtHHmm(this.calendarForm.startTime)||"09:00",t=this.fmtHHmm(this.calendarForm.endTime)||"20:00",[e,a]=s.split(":").map(c=>Number(c)),[i,n]=t.split(":").map(c=>Number(c));let l=e*60+a,r=i*60+n;r<=l&&(r=l+Math.max(30,Number(this.calendarForm.durationMinutes)||60));const d=[];for(;l<=r;){const c=Math.floor(l/60),m=l%60;d.push(`${String(c).padStart(2,"0")}:${String(m).padStart(2,"0")}`),l+=15}return d},onTimePointChange(s,t){const e=this.fmtHHmm(t);if(!e)return;s.timePoint=e,s.dateTime=`${s.date} ${e}`;const a=Number(s.durationMinutes)||Number(this.calendarForm.durationMinutes)||60,[i,n]=e.split(":").map(o=>Number(o)),r=i*60+n+a,d=Math.floor(r/60),c=r%60,m=`${String(d).padStart(2,"0")}:${String(c).padStart(2,"0")}`;s.timeRange=`${e}-${m}`},async persistSchedules(){if(!this.calendarSchedules.length){this.$message.warning("请先生成排课列表");return}const s=[];for(const t of this.calendarSchedules){const e=!!t.classType;this.fmtClassType(t.classType);const a=!!t.teacherId,i=!!t.date,n=t.timePoint||t.dateTime&&t.dateTime.split(" ")[1]||this.fmtHHmm(this.calendarForm.startTime)||"";t.timeRange&&t.timeRange.split("-")[1],(!e||!a||!i||!n)&&s.push(t)}if(s.length){this.$message.error("排课数据不完整，请检查班级类型、班级/老师、日期与时间");return}try{const t=localStorage.getItem("AUTH_TOKEN")||"",e={items:this.calendarSchedules.map(n=>({classId:n.classId||this.calendarForm.classId||null,classType:n.classType,teacherId:n.teacherId,classroomId:n.classroomId||this.calendarForm.classroomId||null,date:n.date,start:n.timePoint||n.dateTime&&n.dateTime.split(" ")[1]||this.fmtHHmm(this.calendarForm.startTime)||"09:00",end:n.timeRange&&n.timeRange.split("-")[1]||null,durationMinutes:n.durationMinutes,fee:n.fee}))};e.items=e.items.map(n=>{if(!n.end){const[l,r]=n.start.split(":").map(u=>Number(u)),c=l*60+r+(n.durationMinutes||60),m=Math.floor(c/60),o=c%60;n.end=`${String(m).padStart(2,"0")}:${String(o).padStart(2,"0")}`}return n});const i=await(await fetch("/api/schedule/manual/save",{method:"POST",headers:{"Content-Type":"application/json",Authorization:t?"Bearer "+t:void 0},body:JSON.stringify(e)})).json();i&&i.code===200?(this.$message.success(`提交成功：已保存 ${i.data&&i.data.savedCount||0} 条`),this.hasUnsavedSchedules=!1):this.$message.error(`提交失败：${i&&i.message||"未知错误"}`)}catch(t){this.$message.error("提交异常："+t.message)}},fmtClassType(s){const t=s==null?"":String(s);return t==="1"?"班课":t==="2"?"一对一":t==="班课"||t==="一对一"?t:t||""},async checkConflicts(){if(this.calendarSchedules.length){this.loading=!0;try{for(const s of this.calendarSchedules){const t=new URLSearchParams({date:s.date,start:s.timeRange.split("-")[0],end:s.timeRange.split("-")[1]}),e=this.fmtClassType(s.classType);e==="班课"&&s.classId?t.append("classId",String(s.classId)):e==="一对一"&&s.teacherId?t.append("teacherId",String(s.teacherId)):s.classId&&t.append("classId",String(s.classId));const a=s.classroomId||this.calendarForm.classroomId;if(a){const r=(this.classroomOptions||[]).find(d=>String(d.id)===String(a));r&&(r.name&&t.append("room",r.name),r.campusId&&t.append("campusId",String(r.campusId)))}s.teacherId&&t.append("teacherId",String(s.teacherId));const i=localStorage.getItem("AUTH_TOKEN")||"",l=await(await fetch("/api/schedule/conflict/check?"+t.toString(),{headers:i?{Authorization:"Bearer "+i}:void 0})).json();s.conflict=!(l&&l.code===200&&l.data&&l.data.ok),s.status=s.conflict?"冲突":"正常"}}catch(s){this.$message.error("冲突检查失败: "+s.message)}finally{this.loading=!1}}},onScheduleTeacherChange(s){},onScheduleSubjectChange(s){},openEdit(s){this.editingRecord=s,this.editForm=Object.assign({},s),this.syncEditFeeWithDuration(),this.editVisible=!0},closeEdit(){this.editVisible=!1,this.editingRecord=null,this.editForm={}},saveEdit(){if(!this.editingRecord)return;const s=this.editingRecord,t=this.editForm;s.teacherId=t.teacherId,s.subject=t.subject,s.durationMinutes=t.durationMinutes,s.fee=Math.round((Number(s.durationMinutes)||60)/60)*100,s.startTime=this.fmtHHmm(t.startTime),s.endTime=this.fmtHHmm(t.endTime),s.timeRange=`${s.startTime}-${s.endTime}`,s.dateTime=`${s.date} ${s.startTime}`,this.editVisible=!1,this.$message.success("已应用微调")},syncFeeWithDuration(){const s=Number(this.calendarForm.durationMinutes)||60;this.calendarForm.fee=Math.round(s/60)*100},onEditDurationChange(){this.syncEditFeeWithDuration()},syncEditFeeWithDuration(){if(!this.editForm)return;const s=Number(this.editForm.durationMinutes)||60;this.editForm.fee=Math.round(s/60)*100},async submitCalendarSchedules(){},fmtHHmm(s){if(!s)return"";if(typeof s.format=="function")try{return s.format("HH:mm")}catch{}if(typeof s=="string"){const t=s.trim().match(/^([0-2]?\d):([0-5]\d)$/);if(t){const e=String(Math.min(23,Number(t[1]))).padStart(2,"0"),a=t[2];return`${e}:${a}`}return""}try{const t=s.getHours&&s.getHours()||0,e=s.getMinutes&&s.getMinutes()||0;return`${String(t).padStart(2,"0")}:${String(e).padStart(2,"0")}`}catch{return""}}}};var v=function(){var t=this,e=t._self._c;return e("div",{staticStyle:{background:"#fff",padding:"10px"}},[e("div",{staticStyle:{"font-size":"16px","font-weight":"600","margin-bottom":"6px"}},[t._v("排课管理")]),t.fixedClassMode?e("div",{staticClass:"fixed-class-summary",staticStyle:{"margin-bottom":"6px"}},[e("a-descriptions",{attrs:{size:"small",column:3}},[e("a-descriptions-item",{attrs:{label:"班级"}},[t._v(t._s(t.fixedClassMeta.className||"班级#"+t.fixedClassMeta.classId))]),e("a-descriptions-item",{attrs:{label:"班级ID"}},[t._v(t._s(t.fixedClassMeta.classId))]),e("a-descriptions-item",{attrs:{label:"授课模式/类型"}},[t._v(t._s((t.fixedClassMeta.mode||"-")+" / "+t.fmtClassType(t.calendarForm.classType)))]),e("a-descriptions-item",{attrs:{label:"科目"}},[e("a-tag",{attrs:{color:"blue"}},[t._v(t._s(t.calendarForm.subject||"-"))])],1)],1),e("input",{attrs:{type:"hidden"},domProps:{value:t.calendarForm.classId}})],1):t._e(),e("a-form",{staticClass:"compact-form",attrs:{layout:"horizontal",labelCol:{span:6},wrapperCol:{span:18}}},[e("a-row",{staticClass:"compact-row",attrs:{gutter:[8,6]}},[t.fixedClassMode?t._e():e("a-col",{attrs:{xs:24,sm:12,md:8,lg:8}},[e("a-form-item",{attrs:{label:"班级"}},[e("a-select",{staticStyle:{width:"100%"},attrs:{allowClear:"",placeholder:"选择班级",size:"small"},on:{change:t.onClassChange},model:{value:t.calendarForm.classId,callback:function(a){t.$set(t.calendarForm,"classId",a)},expression:"calendarForm.classId"}},t._l(t.classOptions,function(a){return e("a-select-option",{key:a.id,attrs:{value:a.id}},[t._v(t._s(a.name||"班级#"+a.id))])}),1)],1)],1),t.fixedClassMode?t._e():e("a-col",{attrs:{xs:24,sm:12,md:8,lg:8}},[e("a-form-item",{attrs:{label:"班级类型"}},[e("a-select",{staticStyle:{width:"100%"},attrs:{allowClear:"",placeholder:"选择班级类型",size:"small",disabled:!!t.calendarForm.classId},model:{value:t.calendarForm.classType,callback:function(a){t.$set(t.calendarForm,"classType",a)},expression:"calendarForm.classType"}},[e("a-select-option",{attrs:{value:"1"}},[t._v("班课")]),e("a-select-option",{attrs:{value:"2"}},[t._v("一对一")])],1)],1)],1),t.fixedClassMode?t._e():e("a-col",{attrs:{xs:24,sm:12,md:8,lg:8}},[e("a-form-item",{attrs:{label:"科目"}},[e("a-select",{staticStyle:{width:"100%"},attrs:{allowClear:"",placeholder:"选择科目",size:"small"},model:{value:t.calendarForm.subject,callback:function(a){t.$set(t.calendarForm,"subject",a)},expression:"calendarForm.subject"}},t._l(t.subjectOptions,function(a){return e("a-select-option",{key:a.id||a.name,attrs:{value:a.name}},[t._v(t._s(a.name))])}),1)],1)],1)],1),e("a-row",{staticClass:"compact-row",staticStyle:{"margin-top":"4px"},attrs:{gutter:[8,6]}},[e("a-col",{attrs:{xs:24,sm:12,md:8,lg:8}},[e("a-form-item",{attrs:{label:"目标月份"}},[e("a-space",{attrs:{size:6}},[e("a-input",{staticStyle:{width:"110px"},attrs:{placeholder:"YYYY-MM",size:"small"},on:{change:t.onCalendarMonthInputChange},model:{value:t.calendarMonthStr,callback:function(a){t.calendarMonthStr=a},expression:"calendarMonthStr"}}),e("a-button",{attrs:{size:"small"},on:{click:t.prevMonth}},[t._v("上个月")]),e("a-button",{attrs:{size:"small"},on:{click:t.nextMonth}},[t._v("下个月")])],1)],1)],1),e("a-col",{attrs:{xs:24,sm:12,md:8,lg:8}},[e("a-form-item",{staticClass:"time-range",attrs:{label:"上课时间："}},[e("a-input",{staticStyle:{width:"96px"},attrs:{placeholder:"HH:mm",size:"small"},model:{value:t.calendarForm.startTime,callback:function(a){t.$set(t.calendarForm,"startTime",a)},expression:"calendarForm.startTime"}}),e("span",{staticStyle:{margin:"0 8px"}},[t._v("-")]),e("a-input",{staticStyle:{width:"96px"},attrs:{placeholder:"HH:mm",size:"small"},model:{value:t.calendarForm.endTime,callback:function(a){t.$set(t.calendarForm,"endTime",a)},expression:"calendarForm.endTime"}})],1)],1),e("a-col",{attrs:{xs:24,sm:12,md:8,lg:8}},[e("a-form-item",{attrs:{label:"课时"}},[e("a-select",{staticStyle:{width:"100%"},attrs:{size:"small"},model:{value:t.calendarForm.durationMinutes,callback:function(a){t.$set(t.calendarForm,"durationMinutes",a)},expression:"calendarForm.durationMinutes"}},[e("a-select-option",{attrs:{value:60}},[t._v("1小时")]),e("a-select-option",{attrs:{value:120}},[t._v("2小时")]),e("a-select-option",{attrs:{value:180}},[t._v("3小时")])],1)],1)],1)],1),e("a-row",{staticClass:"compact-row",staticStyle:{"margin-top":"4px"},attrs:{gutter:[8,6]}},[e("a-col",{attrs:{xs:24,sm:12,md:8,lg:8}},[e("a-form-item",{attrs:{label:"课时单价(元)"}},[e("a-input-number",{staticStyle:{width:"100%"},attrs:{min:0,step:10,disabled:!0,size:"small"},model:{value:t.calendarForm.fee,callback:function(a){t.$set(t.calendarForm,"fee",a)},expression:"calendarForm.fee"}})],1)],1),e("a-col",{attrs:{xs:24,sm:12,md:8,lg:8}},[e("a-form-item",{attrs:{label:"老师"}},[e("a-select",{staticStyle:{width:"100%"},attrs:{allowClear:"",placeholder:"选择老师",size:"small"},model:{value:t.calendarForm.teacherId,callback:function(a){t.$set(t.calendarForm,"teacherId",a)},expression:"calendarForm.teacherId"}},t._l(t.teacherOptions,function(a){return e("a-select-option",{key:a.id,attrs:{value:a.id}},[t._v(t._s(a.name||"老师#"+a.id))])}),1)],1)],1),e("a-col",{attrs:{xs:24,sm:12,md:8,lg:8}},[e("a-form-item",{attrs:{label:"教室"}},[e("a-select",{staticStyle:{width:"100%"},attrs:{allowClear:"","show-search":"",placeholder:"选择教室",size:"small"},model:{value:t.calendarForm.classroomId,callback:function(a){t.$set(t.calendarForm,"classroomId",a)},expression:"calendarForm.classroomId"}},t._l(t.classroomOptions,function(a){return e("a-select-option",{key:a.id,attrs:{value:a.id}},[t._v(t._s(a.name)+"（可用座位："+t._s(a.usableSeats)+"）")])}),1)],1)],1)],1)],1),e("div",{staticClass:"schedule-block"},[e("table",{staticClass:"form-actions-table"},[e("tbody",[e("tr",[e("td",[e("div",{staticClass:"form-actions"},[e("a-space",{attrs:{size:6}},[e("a-button",{attrs:{size:"small",type:"primary",loading:t.loading},on:{click:t.generateCalendarList}},[t._v("生成排课列表")]),e("a-button",{attrs:{size:"small",disabled:!t.calendarSchedules.length},on:{click:t.checkConflicts}},[t._v("检查冲突")]),e("a-button",{attrs:{size:"small",type:"dashed",disabled:!t.calendarSchedules.length},on:{click:t.persistSchedules}},[t._v("提交到后台")]),e("a-button",{attrs:{size:"small"},on:{click:t.clearSelections}},[t._v("清空日期选择")])],1)],1)])])])]),e("div",{staticClass:"schedule-content"},[e("div",{staticClass:"schedule-calendar"},[e("div",{staticClass:"calendar-grid"},[t._m(0),e("div",{staticClass:"calendar-body"},t._l(t.calendarWeeks,function(a,i){return e("div",{key:i,staticClass:"row"},t._l(a,function(n,l){return e("div",{key:n.dateStr||i+"-"+l,staticClass:"cell",class:{disabled:!n.inMonth,selected:!!n.selected},on:{click:function(r){return t.onCalendarCellClick(n)}}},[e("span",{staticClass:"day-number"},[t._v(t._s(n.dayNum||""))])])}),0)}),0)])]),t.calendarSchedules.length?e("div",{staticClass:"schedule-list"},[e("a-alert",{staticStyle:{"margin-bottom":"8px"},attrs:{type:"info",message:"已选择 "+t.selectedDates.length+" 天，生成 "+t.calendarSchedules.length+" 条排课","show-icon":""}}),e("a-table",{attrs:{"data-source":t.calendarSchedules,columns:t.calendarColumns,rowKey:"key",pagination:!1,size:"small"},scopedSlots:t._u([{key:"classType",fn:function(a,i){return[e("span",[t._v(t._s(t.fmtClassType(i.classType)))])]}},{key:"teacher",fn:function(a,i){return[e("a-select",{staticStyle:{width:"100%"},attrs:{size:"small"},on:{change:function(n){return t.onScheduleTeacherChange(i)}},model:{value:i.teacherId,callback:function(n){t.$set(i,"teacherId",n)},expression:"record.teacherId"}},t._l(t.teacherOptions,function(n){return e("a-select-option",{key:n.id,attrs:{value:n.id}},[t._v(t._s(n.name||"老师#"+n.id))])}),1)]}},{key:"durationMinutes",fn:function(a,i){return[e("span",[t._v(t._s(Number(a||i.durationMinutes||0)/60)+" 小时")])]}},{key:"fee",fn:function(a,i){return[e("span",[t._v("￥"+t._s(Number(a||i.fee||0)))])]}},{key:"subject",fn:function(a,i){return[e("a-select",{staticStyle:{width:"100%"},attrs:{size:"small"},on:{change:function(n){return t.onScheduleSubjectChange(i)}},model:{value:i.subject,callback:function(n){t.$set(i,"subject",n)},expression:"record.subject"}},t._l(t.subjectOptions,function(n){return e("a-select-option",{key:n.id||n.name,attrs:{value:n.name}},[t._v(t._s(n.name))])}),1)]}},{key:"classroom",fn:function(a,i){return[e("a-select",{staticStyle:{width:"100%"},attrs:{size:"small"},model:{value:i.classroomId,callback:function(n){t.$set(i,"classroomId",n)},expression:"record.classroomId"}},t._l(t.classroomOptions,function(n){return e("a-select-option",{key:n.id,attrs:{value:n.id}},[t._v(t._s(n.name)+"（可用座位："+t._s(n.usableSeats)+"）")])}),1)]}},{key:"timePoint",fn:function(a,i){return[e("a-select",{staticStyle:{width:"100%"},attrs:{value:i.timePoint||i.dateTime&&i.dateTime.split(" ")[1],size:"small"},on:{change:n=>t.onTimePointChange(i,n)}},t._l(t.getTimePointOptions(),function(n){return e("a-select-option",{key:n,attrs:{value:n}},[t._v(t._s(n))])}),1)]}},{key:"ops",fn:function(a,i){return[e("a-space",{attrs:{size:6}},[e("a-popconfirm",{attrs:{title:"确认提交保存？","ok-text":"提交","cancel-text":"取消"},on:{confirm:t.persistSchedules}},[e("a-button",{attrs:{size:"small",type:"primary"}},[t._v("保存")])],1)],1)]}}],null,!1,3390400221)})],1):t._e()])])],1)},_=[function(){var s=this,t=s._self._c;return t("div",{staticClass:"calendar-header"},[t("div",{staticClass:"cell"},[s._v("周一")]),t("div",{staticClass:"cell"},[s._v("周二")]),t("div",{staticClass:"cell"},[s._v("周三")]),t("div",{staticClass:"cell"},[s._v("周四")]),t("div",{staticClass:"cell"},[s._v("周五")]),t("div",{staticClass:"cell"},[s._v("周六")]),t("div",{staticClass:"cell"},[s._v("周日")])])}],C=S(b,v,_,!1,null,null,null,null);const T=C.exports;export{T as default};
