import{n}from"./index-67337038.js";const o={name:"InvoiceApply",data(){return{form:{studentId:"",settlementId:null,title:"",taxNo:"",amount:0},studentOptions:[],settlements:[],applications:[],columns:[{title:"申请ID",dataIndex:"id",key:"id"},{title:"学员ID",dataIndex:"studentId",key:"studentId"},{title:"缴费记录ID",dataIndex:"settlementId",key:"settlementId"},{title:"抬头",dataIndex:"title",key:"title"},{title:"税号",dataIndex:"taxNo",key:"taxNo"},{title:"金额",dataIndex:"amount",key:"amount"},{title:"状态",dataIndex:"status",key:"status",scopedSlots:{customRender:"status"}}]}},methods:{async loadStudentOptions(){try{const t=await(await fetch("/api/student/list")).json(),e=Array.isArray(t.data)?t.data:[];this.studentOptions=e.map(a=>({id:a.id,name:a.name}))}catch{this.studentOptions=[]}},async loadSettlements(){try{const t=await(await fetch("/api/finance/settlement/list")).json();this.settlements=Array.isArray(t.data)?t.data:[]}catch{this.settlements=[]}},async loadApplications(){try{const t=await(await fetch("/api/finance/invoice/applications")).json();this.applications=Array.isArray(t.data)?t.data:[]}catch{this.applications=[]}},async submit(){const s={studentId:this.form.studentId,settlementId:this.form.settlementId,title:this.form.title,taxNo:this.form.taxNo,amount:this.form.amount},e=await(await fetch("/api/finance/invoice/apply",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)})).json();e&&e.code===0?(this.$message&&this.$message.success("提交成功"),this.loadApplications(),this.reset()):this.$message&&this.$message.error("提交失败："+(e.msg||"未知错误"))},reset(){this.form={studentId:"",settlementId:null,title:"",taxNo:"",amount:0}}},mounted(){this.loadStudentOptions(),this.loadSettlements(),this.loadApplications()}};var i=function(){var t=this,e=t._self._c;return e("div",{staticClass:"invoice-apply"},[e("a-page-header",{attrs:{title:"开票申请","sub-title":"学员提交抬头、税号、金额并关联缴费记录"}}),e("a-card",{staticStyle:{"margin-bottom":"12px"},attrs:{bordered:"",title:"申请信息"}},[e("a-form",{attrs:{"label-col":{span:6},"wrapper-col":{span:12}}},[e("a-form-item",{attrs:{label:"学员"}},[e("a-select",{staticStyle:{width:"100%"},attrs:{placeholder:"选择学员",allowClear:""},model:{value:t.form.studentId,callback:function(a){t.$set(t.form,"studentId",a)},expression:"form.studentId"}},t._l(t.studentOptions,function(a){return e("a-select-option",{key:a.id,attrs:{value:a.id}},[t._v(t._s(a.name)+"（ID: "+t._s(a.id)+"）")])}),1)],1),e("a-form-item",{attrs:{label:"关联缴费记录"}},[e("a-select",{staticStyle:{width:"100%"},attrs:{placeholder:"选择缴费记录",allowClear:""},model:{value:t.form.settlementId,callback:function(a){t.$set(t.form,"settlementId",a)},expression:"form.settlementId"}},t._l(t.settlements,function(a){return e("a-select-option",{key:a.id,attrs:{value:a.id}},[t._v(t._s(a.id)+" | 学员 "+t._s(a.studentId)+" | 金额 ¥"+t._s(a.totalFee))])}),1)],1),e("a-form-item",{attrs:{label:"发票抬头"}},[e("a-input",{attrs:{placeholder:"填写发票抬头"},model:{value:t.form.title,callback:function(a){t.$set(t.form,"title",a)},expression:"form.title"}})],1),e("a-form-item",{attrs:{label:"税号"}},[e("a-input",{attrs:{placeholder:"填写税号"},model:{value:t.form.taxNo,callback:function(a){t.$set(t.form,"taxNo",a)},expression:"form.taxNo"}})],1),e("a-form-item",{attrs:{label:"开票金额"}},[e("a-input-number",{staticStyle:{width:"100%"},attrs:{min:0},model:{value:t.form.amount,callback:function(a){t.$set(t.form,"amount",a)},expression:"form.amount"}})],1),e("a-form-item",{attrs:{"wrapper-col":{span:12,offset:6}}},[e("a-space",[e("a-button",{directives:[{name:"perm",rawName:"v-perm",value:"finance:invoice:apply",expression:"'finance:invoice:apply'"}],attrs:{type:"primary"},on:{click:t.submit}},[t._v("提交申请")]),e("a-button",{on:{click:t.reset}},[t._v("重置")])],1)],1)],1)],1),e("a-card",{attrs:{bordered:"",title:"最近申请"}},[e("a-table",{attrs:{"data-source":t.applications,columns:t.columns,rowKey:"id",pagination:!1},scopedSlots:t._u([{key:"status",fn:function(a){return[a.text==="APPLIED"?e("a-tag",{attrs:{color:"orange"}},[t._v("已申请")]):e("a-tag",{attrs:{color:"green"}},[t._v("已开票")])]}}])})],1)],1)},l=[],r=n(o,i,l,!1,null,"44489cea",null,null);const d=r.exports;export{d as default};
