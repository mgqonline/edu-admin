import{n as l}from"./index-67337038.js";const r={name:"StudentClassSelect",data(){return{filters:{keyword:"",courseId:"",teacherId:"",campusId:"",status:""},teacherOptions:[],campusOptions:[],classes:[],pagination:{current:1,pageSize:10,total:0},studentId:"",records:[],appsVisible:!1,appsClassId:null,apps:[],applyVisible:!1,applyClass:null,applyForm:{confirmCourseId:"",note:""},applyErrors:{courseId:""}}},computed:{columns(){return[{title:"班号",dataIndex:"classNo"},{title:"班级名称",dataIndex:"name"},{title:"课程ID",dataIndex:"courseId"},{title:"校区",dataIndex:"campusId"},{title:"教室",dataIndex:"room"},{title:"最大人数",dataIndex:"maxSize"},{title:"剩余名额",dataIndex:"remaining"},{title:"操作",key:"apply",scopedSlots:{customRender:"apply"}}]},recordColumns(){return[{title:"类型",dataIndex:"type"},{title:"来源班级",dataIndex:"fromClassId"},{title:"目标班级",dataIndex:"toClassId"},{title:"时间",dataIndex:"time"},{title:"原因",dataIndex:"reason"}]},appsColumns(){return[{title:"申请ID",dataIndex:"id"},{title:"学员ID",dataIndex:"studentId"},{title:"状态",dataIndex:"status"},{title:"备注",dataIndex:"note"}]}},created(){this.loadClasses(),this.loadTeacherOptions(),this.loadCampusOptions()},methods:{async loadTeacherOptions(){try{const t=await(await fetch("/api/teacher/list")).json();this.teacherOptions=t&&t.code===200?t.data||[]:[]}catch{this.teacherOptions=[]}},async loadCampusOptions(){try{const t=await(await fetch("/api/base/campus/list")).json();this.campusOptions=t&&t.code===200?t.data||[]:[]}catch{this.campusOptions=[]}},async loadClasses(){const a=[];this.filters.keyword&&a.push("q="+encodeURIComponent(this.filters.keyword)),this.filters.courseId&&a.push("courseId="+encodeURIComponent(this.filters.courseId)),this.filters.teacherId&&a.push("teacherId="+encodeURIComponent(this.filters.teacherId)),this.filters.campusId&&a.push("campusId="+encodeURIComponent(this.filters.campusId)),this.filters.status&&a.push("status="+encodeURIComponent(this.filters.status)),a.push("page="+encodeURIComponent(this.pagination.current)),a.push("size="+encodeURIComponent(this.pagination.pageSize));const t=a.length?"?"+a.join("&"):"",s=await(await fetch("/api/class/list"+t)).json(),i=s&&s.code===200?s.data||{}:{};this.classes=Array.isArray(i.items)?i.items:Array.isArray(s.data)?s.data:[],this.pagination={...this.pagination,total:Number(i.total||0)}},onTableChange(a){this.pagination={...this.pagination,current:a.current,pageSize:a.pageSize},this.loadClasses()},resetFilters(){this.filters={keyword:"",courseId:"",teacherId:"",campusId:"",status:""}},applySelect(a){if(!this.studentId){this.$message.error("请先填写学员ID");return}const t=Number(this.studentId);if(!Number.isFinite(t)||t<=0){this.$message.error("学员ID无效，应为正整数");return}this.applyClass=a,this.applyForm={confirmCourseId:"",note:""},this.applyErrors={courseId:""},this.applyVisible=!0},closeApply(){this.applyVisible=!1,this.applyClass=null},async doApplySelect(){const a=String(this.applyForm.confirmCourseId||"").trim();if(!a){this.applyErrors.courseId="课程ID不能为空";return}if(String(a)!==String(this.applyClass.courseId)){this.applyErrors.courseId="课程ID不匹配，请确认";return}this.applyErrors.courseId="";const t=Number(this.studentId),e={classId:this.applyClass.id,studentId:t,note:this.applyForm.note||""},i=await(await fetch("/api/class/select/apply",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).json();i&&i.code===200?(this.$message.success("已提交选班申请"),this.applyVisible=!1,this.openApps(this.applyClass)):this.$message.error("提交失败")},async loadRecords(){if(!this.studentId){this.$message.error("请填写学员ID");return}const t=await(await fetch(`/api/class/records?studentId=${encodeURIComponent(this.studentId)}`)).json();this.records=t&&t.code===200?t.data||[]:[]},async openApps(a){this.appsClassId=a.id;const e=await(await fetch(`/api/class/select/list?classId=${a.id}`)).json();this.apps=e&&e.code===200?e.data||[]:[],this.appsVisible=!0}}};var n=function(){var t=this,e=t._self._c;return e("div",{staticStyle:{background:"#fff",padding:"16px"}},[e("h3",[t._v("学员选班申请")]),e("a-space",{staticStyle:{"margin-bottom":"12px"},attrs:{wrap:""}},[e("a-input",{staticStyle:{width:"220px"},attrs:{placeholder:"按班级名称关键字"},model:{value:t.filters.keyword,callback:function(s){t.$set(t.filters,"keyword",s)},expression:"filters.keyword"}}),e("a-input",{staticStyle:{width:"180px"},attrs:{placeholder:"课程ID（可选）"},model:{value:t.filters.courseId,callback:function(s){t.$set(t.filters,"courseId",s)},expression:"filters.courseId"}}),e("a-select",{staticStyle:{width:"220px"},attrs:{placeholder:"教师（可选）",allowClear:""},model:{value:t.filters.teacherId,callback:function(s){t.$set(t.filters,"teacherId",s)},expression:"filters.teacherId"}},t._l(t.teacherOptions,function(s){return e("a-select-option",{key:s.id,attrs:{value:s.id}},[t._v(t._s(s.name||s.title||"#"+s.id))])}),1),e("a-select",{staticStyle:{width:"200px"},attrs:{placeholder:"校区（可选）",allowClear:""},model:{value:t.filters.campusId,callback:function(s){t.$set(t.filters,"campusId",s)},expression:"filters.campusId"}},t._l(t.campusOptions,function(s){return e("a-select-option",{key:s.id,attrs:{value:s.id}},[t._v(t._s(s.title||s.name||"#"+s.id))])}),1),e("a-select",{staticStyle:{width:"160px"},attrs:{placeholder:"状态筛选",allowClear:""},model:{value:t.filters.status,callback:function(s){t.$set(t.filters,"status",s)},expression:"filters.status"}},[e("a-select-option",{attrs:{value:"not_started"}},[t._v("未开课")]),e("a-select-option",{attrs:{value:"ongoing"}},[t._v("进行中")]),e("a-select-option",{attrs:{value:"ended"}},[t._v("已结课")]),e("a-select-option",{attrs:{value:"suspended"}},[t._v("临时停课")])],1)],1),e("a-space",{staticStyle:{margin:"8px 0 12px"},attrs:{wrap:""}},[e("a-input",{staticStyle:{width:"160px"},attrs:{placeholder:"学员ID"},model:{value:t.studentId,callback:function(s){t.studentId=s},expression:"studentId"}}),e("a-button",{on:{click:t.loadRecords}},[t._v("查看分班记录")]),e("a-button",{attrs:{type:"primary"},on:{click:t.loadClasses}},[t._v("查询班级")]),e("a-button",{on:{click:t.resetFilters}},[t._v("清空筛选")])],1),e("a-table",{attrs:{columns:t.columns,"data-source":t.classes,rowKey:"id",pagination:t.pagination},on:{change:t.onTableChange},scopedSlots:t._u([{key:"apply",fn:function(s,i){return e("span",{},[e("a-space",[e("a-button",{attrs:{type:"link"},on:{click:function(o){return t.applySelect(i)}}},[t._v("申请选班")]),e("a-button",{attrs:{type:"link"},on:{click:function(o){return t.openApps(i)}}},[t._v("查看该班申请")])],1)],1)}}])}),e("a-divider"),e("h4",[t._v("学员分班记录")]),e("a-table",{attrs:{columns:t.recordColumns,"data-source":t.records,rowKey:"time",pagination:!1}}),e("a-modal",{attrs:{visible:t.appsVisible,title:"班级选班申请",footer:"null"},on:{cancel:function(s){t.appsVisible=!1}}},[e("a-table",{attrs:{columns:t.appsColumns,"data-source":t.apps,rowKey:"id",pagination:!1}})],1),e("a-modal",{attrs:{visible:t.applyVisible,title:"提交选班申请"},on:{ok:t.doApplySelect,cancel:t.closeApply}},[e("a-form",{attrs:{layout:"vertical"}},[e("a-form-item",{attrs:{label:"确认课程ID","validate-status":t.applyErrors.courseId&&"error",help:t.applyErrors.courseId}},[e("a-input",{attrs:{placeholder:"请输入当前班级的课程ID以确认"},model:{value:t.applyForm.confirmCourseId,callback:function(s){t.$set(t.applyForm,"confirmCourseId",s)},expression:"applyForm.confirmCourseId"}})],1),e("a-form-item",{attrs:{label:"备注（可选）"}},[e("a-input",{attrs:{placeholder:"可填写备注信息"},model:{value:t.applyForm.note,callback:function(s){t.$set(t.applyForm,"note",s)},expression:"applyForm.note"}})],1),e("a-alert",{attrs:{type:"info","show-icon":"",message:"当前班级课程ID：",description:String(t.applyClass&&t.applyClass.courseId||"")}})],1)],1)],1)},p=[],c=l(r,n,p,!1,null,"df286159",null,null);const u=c.exports;export{u as default};
