import{n,_ as o}from"./index-67337038.js";const i={name:"InvoiceStat",data(){return{query:{month:"",campusId:null},campusOptions:[],summary:{month:"",totalAmount:0,byCampus:{}},campusColumns:[{title:"校区ID",dataIndex:"campusId",key:"campusId"},{title:"金额",dataIndex:"amount",key:"amount"}]}},components:{V2SimpleDate:()=>o(()=>import("./V2SimpleDate-11821f76.js"),["assets/V2SimpleDate-11821f76.js","assets/index-67337038.js","assets/index-f5f188af.css","assets/V2SimpleDate-9b3aafb8.css"])},computed:{campusList(){const s=this.summary&&this.summary.byCampus?this.summary.byCampus:{};return Object.keys(s).map(t=>({campusId:Number(t),amount:s[t]}))}},methods:{async loadCampusOptions(){try{const t=await(await fetch("/api/base/campus/list")).json();t&&t.code===200?this.campusOptions=Array.isArray(t.data)?t.data:[]:this.campusOptions=[]}catch{this.campusOptions=[]}},async loadSummary(){if(!this.query.month){this.$message&&this.$message.warning("请填写月份");return}const s=["month="+encodeURIComponent(this.query.month)];this.query.campusId!=null&&this.query.campusId!==""&&s.push("campusId="+encodeURIComponent(this.query.campusId));const t="/api/finance/invoice/stat/summary?"+s.join("&"),e=await(await fetch(t)).json();e&&e.code===0?this.summary=e.data||{month:"",totalAmount:0,byCampus:{}}:this.$message&&this.$message.error("统计失败："+(e.msg||"未知错误"))},exportDetails(){if(!this.query.month){this.$message&&this.$message.warning("请填写月份");return}const s=["month="+encodeURIComponent(this.query.month)];this.query.campusId!=null&&this.query.campusId!==""&&s.push("campusId="+encodeURIComponent(this.query.campusId));const t="/api/finance/invoice/export/details?"+s.join("&");window.open(t,"_blank")}},mounted(){this.loadCampusOptions()}};var r=function(){var t=this,a=t._self._c;return a("div",{staticClass:"invoice-stat"},[a("a-page-header",{attrs:{title:"开票统计","sub-title":"按月份/校区统计开票金额，导出明细"}}),a("a-card",{staticStyle:{"margin-bottom":"12px"},attrs:{bordered:"",title:"统计查询"}},[a("a-form",{attrs:{"label-col":{span:6},"wrapper-col":{span:12}}},[a("a-form-item",{attrs:{label:"月份"}},[a("V2SimpleDate",{staticStyle:{width:"100%"},attrs:{type:"month",format:"YYYY-MM",placeholder:"选择月份"},model:{value:t.query.month,callback:function(e){t.$set(t.query,"month",e)},expression:"query.month"}})],1),a("a-form-item",{attrs:{label:"学校"}},[a("a-select",{staticStyle:{width:"100%"},attrs:{placeholder:"选择学校(可选)",allowClear:""},model:{value:t.query.campusId,callback:function(e){t.$set(t.query,"campusId",e)},expression:"query.campusId"}},t._l(t.campusOptions,function(e){return a("a-select-option",{key:e.id,attrs:{value:e.id}},[t._v(t._s(e.name))])}),1)],1),a("a-form-item",{attrs:{"wrapper-col":{span:12,offset:6}}},[a("a-space",[a("a-button",{directives:[{name:"perm",rawName:"v-perm",value:"finance:invoice:stat",expression:"'finance:invoice:stat'"}],attrs:{type:"primary"},on:{click:t.loadSummary}},[t._v("统计")]),a("a-button",{directives:[{name:"perm",rawName:"v-perm",value:"finance:invoice:export",expression:"'finance:invoice:export'"}],on:{click:t.exportDetails}},[t._v("导出明细")])],1)],1)],1)],1),a("a-card",{attrs:{bordered:"",title:"统计结果"}},[a("a-descriptions",{attrs:{column:1,bordered:""}},[a("a-descriptions-item",{attrs:{label:"月份"}},[t._v(t._s(t.summary.month||"-"))]),a("a-descriptions-item",{attrs:{label:"总金额"}},[t._v(t._s(t.summary.totalAmount||0))])],1),a("a-divider",[t._v("按校区金额")]),a("a-table",{attrs:{"data-source":t.campusList,columns:t.campusColumns,rowKey:"campusId",pagination:!1}})],1)],1)},m=[],c=n(i,r,m,!1,null,"4fb26305",null,null);const p=c.exports;export{p as default};
