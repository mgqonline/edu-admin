import{n as o}from"./index-67337038.js";const l={name:"Campus",data(){return{list:[],rawList:[],visible:!1,loading:!1,submitting:!1,editingId:null,filters:{name:"",phone:""},form:{name:"",address:"",phone:"",manager:"",region:"",config:{signRule:"qrcode",conflictCheckLevel:"strict"}},columns:[{title:"名称",dataIndex:"name"},{title:"地址",dataIndex:"address"},{title:"电话",dataIndex:"phone"},{title:"负责人",dataIndex:"manager"},{title:"所属区域",dataIndex:"region"},{title:"状态",dataIndex:"status"},{title:"操作",key:"action",customRender:(a,e)=>this.$createElement("span",[this.$createElement("a",{on:{click:()=>this.edit(e)}},"编辑"),this.$createElement("span",{style:{margin:"0 8px"}},"|"),this.$createElement("a",{on:{click:()=>this.disable(e)}},"禁用"),this.$createElement("span",{style:{margin:"0 8px"}},"|"),this.$createElement("a",{on:{click:()=>this.goDept(e.id)}},"维护部门")])}]}},created(){this.loadData()},methods:{async loadData(){this.loading=!0;try{const e=await(await fetch("/api/base/campus/list")).json();e&&e.code===200?(this.rawList=e.data||[],this.list=this.rawList,this.$message&&this.$message.success("校区数据已加载")):(this.rawList=[],this.list=[],this.$message&&this.$message.error(e.message||"校区数据加载失败"))}catch{this.$message&&this.$message.error("校区数据加载失败")}finally{this.loading=!1}},searchCampus(){const a=(this.filters.name||"").trim(),e=(this.filters.phone||"").trim();if(!!!(a||e)){this.list=this.rawList;return}const s=a.toLowerCase();this.list=(this.rawList||[]).filter(i=>{const n=a?String(i.name||"").toLowerCase().includes(s):!0,r=e?String(i.phone||"").includes(e):!0;return n&&r})},resetFilters(){this.filters={name:"",phone:""},this.list=this.rawList},openForm(){this.visible=!0,this.editingId=null,this.form={name:"",address:"",phone:"",manager:"",region:"",config:{signRule:"qrcode",conflictCheckLevel:"strict"}}},edit(a){this.visible=!0,this.editingId=a.id,this.form=JSON.parse(JSON.stringify(a))},async submit(){this.submitting=!0;try{if(this.editingId){const e=await(await fetch(`/api/base/campus/update/${this.editingId}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(this.form)})).json();if(!(e&&e.code===200))throw new Error(e&&e.message?e.message:"更新失败")}else{const e=await(await fetch("/api/base/campus/save",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(this.form)})).json();if(!(e&&e.code===200))throw new Error(e&&e.message?e.message:"保存失败")}this.visible=!1,this.$message&&this.$message.success("保存成功"),this.loadData()}catch(a){this.$message&&this.$message.error(a.message||"保存失败")}finally{this.submitting=!1}},async disable(a){try{const t=await(await fetch(`/api/base/campus/disable/${a.id}`,{method:"POST"})).json();t&&t.code===200?(this.$message&&this.$message.success("状态已更新"),this.loadData()):this.$message&&this.$message.error(t.message||"操作失败")}catch{this.$message&&this.$message.error("操作失败")}},goDept(a){this.$router.push({path:"/base/dept",query:{campusId:a}})}}};var c=function(){var e=this,t=e._self._c;return t("div",[t("a-card",{staticStyle:{"margin-bottom":"12px"},attrs:{bordered:""}},[t("a-space",[t("a-button",{attrs:{type:"primary"},on:{click:function(s){return e.openForm()}}},[e._v("新增校区")])],1)],1),t("a-card",{staticStyle:{"margin-bottom":"12px"},attrs:{bordered:""}},[t("a-form",{attrs:{layout:"inline"}},[t("a-form-item",{attrs:{label:"学校/校区"}},[t("a-input",{attrs:{placeholder:"按名称搜索",allowClear:""},model:{value:e.filters.name,callback:function(s){e.$set(e.filters,"name",s)},expression:"filters.name"}})],1),t("a-form-item",{attrs:{label:"电话"}},[t("a-input",{attrs:{placeholder:"联系电话",allowClear:""},model:{value:e.filters.phone,callback:function(s){e.$set(e.filters,"phone",s)},expression:"filters.phone"}})],1),t("a-form-item",[t("a-space",[t("a-button",{attrs:{type:"primary"},on:{click:e.searchCampus}},[e._v("查询")]),t("a-button",{on:{click:e.resetFilters}},[e._v("重置")])],1)],1)],1)],1),t("a-table",{attrs:{"data-source":e.list,columns:e.columns,rowKey:"id"}}),t("a-modal",{attrs:{visible:e.visible,title:"校区信息",confirmLoading:e.submitting},on:{ok:e.submit,cancel:function(s){e.visible=!1}}},[t("a-form",{attrs:{layout:"vertical"}},[t("a-form-item",{attrs:{label:"名称"}},[t("a-input",{model:{value:e.form.name,callback:function(s){e.$set(e.form,"name",s)},expression:"form.name"}})],1),t("a-form-item",{attrs:{label:"地址"}},[t("a-input",{model:{value:e.form.address,callback:function(s){e.$set(e.form,"address",s)},expression:"form.address"}})],1),t("a-form-item",{attrs:{label:"联系电话"}},[t("a-input",{model:{value:e.form.phone,callback:function(s){e.$set(e.form,"phone",s)},expression:"form.phone"}})],1),t("a-form-item",{attrs:{label:"负责人"}},[t("a-input",{model:{value:e.form.manager,callback:function(s){e.$set(e.form,"manager",s)},expression:"form.manager"}})],1),t("a-form-item",{attrs:{label:"所属区域"}},[t("a-input",{model:{value:e.form.region,callback:function(s){e.$set(e.form,"region",s)},expression:"form.region"}})],1),t("a-form-item",{attrs:{label:"默认签到规则"}},[t("a-select",{model:{value:e.form.config.signRule,callback:function(s){e.$set(e.form.config,"signRule",s)},expression:"form.config.signRule"}},[t("a-select-option",{attrs:{value:"qrcode"}},[e._v("二维码")]),t("a-select-option",{attrs:{value:"manual"}},[e._v("人工")])],1)],1),t("a-form-item",{attrs:{label:"冲突校验级别"}},[t("a-select",{model:{value:e.form.config.conflictCheckLevel,callback:function(s){e.$set(e.form.config,"conflictCheckLevel",s)},expression:"form.config.conflictCheckLevel"}},[t("a-select-option",{attrs:{value:"strict"}},[e._v("严格")]),t("a-select-option",{attrs:{value:"normal"}},[e._v("一般")]),t("a-select-option",{attrs:{value:"loose"}},[e._v("宽松")])],1)],1)],1)],1)],1)},m=[],f=o(l,c,m,!1,null,"4424e221",null,null);const d=f.exports;export{d as default};
