import{n as o}from"./index-67337038.js";const l={name:"FeeRuleConfig",data(){return{saving:!1,campusLoading:!1,campusOptions:[],rules:[],ruleColumns:[{title:"校区",dataIndex:"campusName",ellipsis:!0},{title:"等级",dataIndex:"teacherLevel",ellipsis:!0},{title:"基础课时费",dataIndex:"baseFeePerLesson",align:"right"},{title:"一对一系数",dataIndex:"oneToOneFactor",align:"right"},{title:"雅思系数",dataIndex:"ieltsFactor",align:"right"},{title:"大班阈值",dataIndex:"largeClassThreshold",align:"right"},{title:"大班系数",dataIndex:"largeClassFactor",align:"right"},{title:"节假日系数",dataIndex:"holidayFactor",align:"right"},{title:"代课补贴",dataIndex:"substituteExtra",align:"right"},{title:"阶梯阈值",dataIndex:"tierMonthlyThreshold",align:"right"},{title:"阶梯系数",dataIndex:"tierFactor",align:"right"},{title:"操作",key:"action",scopedSlots:{customRender:"action"}}],rulePagination:{current:1,pageSize:10,total:0,showSizeChanger:!0,pageSizeOptions:["10","20","50"]},form:{campusId:null,teacherLevel:"中级",baseFeePerLesson:120,oneToOneFactor:1.5,ieltsFactor:1.2,largeClassThreshold:20,largeClassFactor:1.1,holidayFactor:2,substituteExtra:30,tierMonthlyThreshold:80,tierFactor:1.2},editVisible:!1,editSaving:!1,editForm:{id:null,campusId:null,teacherLevel:"中级",baseFeePerLesson:0,oneToOneFactor:1.5,ieltsFactor:1.2,largeClassThreshold:0,largeClassFactor:1.1,holidayFactor:1,substituteExtra:0,tierMonthlyThreshold:0,tierFactor:1}}},mounted(){this.loadCampuses(),this.loadRules(1,10)},methods:{async save(){this.saving=!0;try{const e=await(await fetch("/api/teacher/fee/rule/save",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(this.form)})).json();if(e&&e.code===200)this.$message&&this.$message.success("规则已保存"),this.loadRules(1,this.rulePagination.pageSize);else throw new Error("保存失败")}catch{this.$message&&this.$message.error("保存失败：网络或服务异常")}finally{this.saving=!1}},reset(){this.form={campusId:null,teacherLevel:"中级",baseFeePerLesson:120,oneToOneFactor:1.5,ieltsFactor:1.2,largeClassThreshold:20,largeClassFactor:1.1,holidayFactor:2,substituteExtra:30,tierMonthlyThreshold:80,tierFactor:1.2}},async loadCampuses(){this.campusLoading=!0;try{const e=await(await fetch("/api/base/campus/list")).json().catch(()=>({})),a=(Array.isArray(e&&e.data)?e.data:[]).filter(r=>String(r.status||"").toLowerCase()==="enabled");this.campusOptions=a.map(r=>({value:r.id,label:r.name||"#"+r.id}))}catch{this.campusOptions=[]}finally{this.campusLoading=!1}},async loadRules(s,e){const t=new URLSearchParams;t.set("page",String(s||1)),t.set("size",String(e||10)),this.form.campusId&&t.set("campusId",String(this.form.campusId));try{const r=await(await fetch("/api/teacher/fee/rule/list?"+t.toString())).json().catch(()=>({})),i=r&&r.data?r.data:{items:[],total:0,page:1,size:10};this.rules=Array.isArray(i.items)?i.items:[],this.rulePagination=Object.assign({},this.rulePagination,{current:Number(i.page||1),pageSize:Number(i.size||10),total:Number(i.total||0)})}catch{this.rules=[],this.rulePagination=Object.assign({},this.rulePagination,{total:0})}},onRuleTableChange(s){const e=s||{},t=Number(e.current||this.rulePagination.current||1),a=Number(e.pageSize||this.rulePagination.pageSize||10);this.loadRules(t,a)},openEdit(s){const e=s||{};this.editForm={id:e.id,campusId:e.campusId||null,teacherLevel:e.teacherLevel||"中级",baseFeePerLesson:Number(e.baseFeePerLesson||0),oneToOneFactor:Number(e.oneToOneFactor||1.5),ieltsFactor:Number(e.ieltsFactor||1.2),largeClassThreshold:Number(e.largeClassThreshold||0),largeClassFactor:Number(e.largeClassFactor||1.1),holidayFactor:Number(e.holidayFactor||1),substituteExtra:Number(e.substituteExtra||0),tierMonthlyThreshold:Number(e.tierMonthlyThreshold||0),tierFactor:Number(e.tierFactor||1)},this.editVisible=!0},closeEdit(){this.editVisible=!1},async saveEdit(){if(!this.editForm||!this.editForm.id){this.$message&&this.$message.error("无效记录");return}this.editSaving=!0;try{const e=await(await fetch(`/api/teacher/fee/rule/update/${this.editForm.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(this.editForm)})).json();if(e&&e.code===200)this.$message&&this.$message.success("已更新，次月生效"),this.editVisible=!1,this.loadRules(this.rulePagination.current,this.rulePagination.pageSize);else throw new Error("更新失败")}catch{this.$message&&this.$message.error("更新失败：网络或服务异常")}finally{this.editSaving=!1}}}};var n=function(){var e=this,t=e._self._c;return t("div",{staticClass:"fee-rule-config"},[t("a-page-header",{attrs:{title:"课时费规则配置","sub-title":"基础与特殊规则"}}),t("a-card",{attrs:{bordered:""}},[t("a-form",{attrs:{"label-col":{span:6},"wrapper-col":{span:12}}},[t("a-form-item",{attrs:{label:"适用校区"}},[t("a-select",{staticStyle:{width:"100%"},attrs:{allowClear:!0,loading:e.campusLoading,placeholder:"留空为全局"},model:{value:e.form.campusId,callback:function(a){e.$set(e.form,"campusId",a)},expression:"form.campusId"}},e._l(e.campusOptions,function(a){return t("a-select-option",{key:a.value,attrs:{value:a.value}},[e._v(e._s(a.label))])}),1)],1),t("a-form-item",{attrs:{label:"教师等级"}},[t("a-select",{attrs:{placeholder:"选择等级"},model:{value:e.form.teacherLevel,callback:function(a){e.$set(e.form,"teacherLevel",a)},expression:"form.teacherLevel"}},[t("a-select-option",{attrs:{value:"初级"}},[e._v("初级")]),t("a-select-option",{attrs:{value:"中级"}},[e._v("中级")]),t("a-select-option",{attrs:{value:"高级"}},[e._v("高级")])],1)],1),t("a-form-item",{attrs:{label:"基础课时费"}},[t("a-input-number",{staticStyle:{width:"100%"},attrs:{min:0},model:{value:e.form.baseFeePerLesson,callback:function(a){e.$set(e.form,"baseFeePerLesson",a)},expression:"form.baseFeePerLesson"}})],1),t("a-divider",[e._v("课程类型系数")]),t("a-form-item",{attrs:{label:"一对一系数"}},[t("a-input-number",{staticStyle:{width:"100%"},attrs:{min:0,step:"0.1"},model:{value:e.form.oneToOneFactor,callback:function(a){e.$set(e.form,"oneToOneFactor",a)},expression:"form.oneToOneFactor"}})],1),t("a-form-item",{attrs:{label:"雅思系数"}},[t("a-input-number",{staticStyle:{width:"100%"},attrs:{min:0,step:"0.1"},model:{value:e.form.ieltsFactor,callback:function(a){e.$set(e.form,"ieltsFactor",a)},expression:"form.ieltsFactor"}})],1),t("a-divider",[e._v("班级规模")]),t("a-form-item",{attrs:{label:"人数阈值"}},[t("a-input-number",{staticStyle:{width:"100%"},attrs:{min:0},model:{value:e.form.largeClassThreshold,callback:function(a){e.$set(e.form,"largeClassThreshold",a)},expression:"form.largeClassThreshold"}})],1),t("a-form-item",{attrs:{label:"上浮系数"}},[t("a-input-number",{staticStyle:{width:"100%"},attrs:{min:0,step:"0.1"},model:{value:e.form.largeClassFactor,callback:function(a){e.$set(e.form,"largeClassFactor",a)},expression:"form.largeClassFactor"}})],1),t("a-divider",[e._v("特殊规则")]),t("a-form-item",{attrs:{label:"节假日系数"}},[t("a-input-number",{staticStyle:{width:"100%"},attrs:{min:0,step:"0.1"},model:{value:e.form.holidayFactor,callback:function(a){e.$set(e.form,"holidayFactor",a)},expression:"form.holidayFactor"}})],1),t("a-form-item",{attrs:{label:"代课加价"}},[t("a-input-number",{staticStyle:{width:"100%"},attrs:{min:0},model:{value:e.form.substituteExtra,callback:function(a){e.$set(e.form,"substituteExtra",a)},expression:"form.substituteExtra"}})],1),t("a-divider",[e._v("阶梯奖励")]),t("a-form-item",{attrs:{label:"月课时阈值"}},[t("a-input-number",{staticStyle:{width:"100%"},attrs:{min:0},model:{value:e.form.tierMonthlyThreshold,callback:function(a){e.$set(e.form,"tierMonthlyThreshold",a)},expression:"form.tierMonthlyThreshold"}})],1),t("a-form-item",{attrs:{label:"超额系数"}},[t("a-input-number",{staticStyle:{width:"100%"},attrs:{min:0,step:"0.1"},model:{value:e.form.tierFactor,callback:function(a){e.$set(e.form,"tierFactor",a)},expression:"form.tierFactor"}})],1),t("a-form-item",{attrs:{"wrapper-col":{span:12,offset:6}}},[t("a-space",[t("a-button",{attrs:{type:"primary",loading:e.saving},on:{click:e.save}},[e._v("保存规则")]),t("a-button",{on:{click:e.reset}},[e._v("重置")])],1)],1)],1)],1),t("a-divider",{attrs:{orientation:"left"}},[e._v("各校区课时费规则")]),t("a-alert",{staticStyle:{"margin-bottom":"8px"},attrs:{type:"warning","show-icon":"",message:"提示",description:"调整后的规则下月才生效"}}),t("div",{staticClass:"rule-table-wrapper"},[t("a-table",{attrs:{columns:e.ruleColumns,"data-source":e.rules,pagination:e.rulePagination,rowKey:"id",size:"middle",bordered:"",scroll:{x:"max-content"}},on:{change:e.onRuleTableChange},scopedSlots:e._u([{key:"action",fn:function(a,r){return t("span",{},[t("a-button",{attrs:{type:"link"},on:{click:function(i){return e.openEdit(r)}}},[e._v("编辑")])],1)}}])})],1),t("a-modal",{attrs:{visible:e.editVisible,title:"编辑课时费规则",confirmLoading:e.editSaving},on:{ok:e.saveEdit,cancel:e.closeEdit}},[t("a-form",{attrs:{"label-col":{span:6},"wrapper-col":{span:14}}},[t("a-form-item",{attrs:{label:"适用校区"}},[t("a-select",{staticStyle:{width:"100%"},attrs:{allowClear:!0,loading:e.campusLoading,placeholder:"留空为全局"},model:{value:e.editForm.campusId,callback:function(a){e.$set(e.editForm,"campusId",a)},expression:"editForm.campusId"}},e._l(e.campusOptions,function(a){return t("a-select-option",{key:a.value,attrs:{value:a.value}},[e._v(e._s(a.label))])}),1)],1),t("a-form-item",{attrs:{label:"教师等级"}},[t("a-select",{attrs:{placeholder:"选择等级"},model:{value:e.editForm.teacherLevel,callback:function(a){e.$set(e.editForm,"teacherLevel",a)},expression:"editForm.teacherLevel"}},[t("a-select-option",{attrs:{value:"初级"}},[e._v("初级")]),t("a-select-option",{attrs:{value:"中级"}},[e._v("中级")]),t("a-select-option",{attrs:{value:"高级"}},[e._v("高级")])],1)],1),t("a-form-item",{attrs:{label:"基础课时费"}},[t("a-input-number",{staticStyle:{width:"100%"},attrs:{min:0},model:{value:e.editForm.baseFeePerLesson,callback:function(a){e.$set(e.editForm,"baseFeePerLesson",a)},expression:"editForm.baseFeePerLesson"}})],1),t("a-form-item",{attrs:{label:"一对一系数"}},[t("a-input-number",{staticStyle:{width:"100%"},attrs:{min:0,step:"0.1"},model:{value:e.editForm.oneToOneFactor,callback:function(a){e.$set(e.editForm,"oneToOneFactor",a)},expression:"editForm.oneToOneFactor"}})],1),t("a-form-item",{attrs:{label:"雅思系数"}},[t("a-input-number",{staticStyle:{width:"100%"},attrs:{min:0,step:"0.1"},model:{value:e.editForm.ieltsFactor,callback:function(a){e.$set(e.editForm,"ieltsFactor",a)},expression:"editForm.ieltsFactor"}})],1),t("a-form-item",{attrs:{label:"大班阈值"}},[t("a-input-number",{staticStyle:{width:"100%"},attrs:{min:0},model:{value:e.editForm.largeClassThreshold,callback:function(a){e.$set(e.editForm,"largeClassThreshold",a)},expression:"editForm.largeClassThreshold"}})],1),t("a-form-item",{attrs:{label:"大班系数"}},[t("a-input-number",{staticStyle:{width:"100%"},attrs:{min:0,step:"0.1"},model:{value:e.editForm.largeClassFactor,callback:function(a){e.$set(e.editForm,"largeClassFactor",a)},expression:"editForm.largeClassFactor"}})],1),t("a-form-item",{attrs:{label:"节假日系数"}},[t("a-input-number",{staticStyle:{width:"100%"},attrs:{min:0,step:"0.1"},model:{value:e.editForm.holidayFactor,callback:function(a){e.$set(e.editForm,"holidayFactor",a)},expression:"editForm.holidayFactor"}})],1),t("a-form-item",{attrs:{label:"代课补贴"}},[t("a-input-number",{staticStyle:{width:"100%"},attrs:{min:0},model:{value:e.editForm.substituteExtra,callback:function(a){e.$set(e.editForm,"substituteExtra",a)},expression:"editForm.substituteExtra"}})],1),t("a-form-item",{attrs:{label:"阶梯阈值"}},[t("a-input-number",{staticStyle:{width:"100%"},attrs:{min:0},model:{value:e.editForm.tierMonthlyThreshold,callback:function(a){e.$set(e.editForm,"tierMonthlyThreshold",a)},expression:"editForm.tierMonthlyThreshold"}})],1),t("a-form-item",{attrs:{label:"阶梯系数"}},[t("a-input-number",{staticStyle:{width:"100%"},attrs:{min:0,step:"0.1"},model:{value:e.editForm.tierFactor,callback:function(a){e.$set(e.editForm,"tierFactor",a)},expression:"editForm.tierFactor"}})],1)],1)],1)],1)},c=[],m=o(l,n,c,!1,null,"aa9cde5d",null,null);const u=m.exports;export{u as default};
