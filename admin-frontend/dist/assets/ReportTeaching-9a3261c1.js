import{n as r,_ as o}from"./index-67337038.js";function s(e){if(!e)return"";if(typeof e=="string"&&/^\d{4}-\d{2}-\d{2}$/.test(e))return e;const t=n=>String(n).padStart(2,"0"),a=new Date(e);return a.getFullYear()+"-"+t(a.getMonth()+1)+"-"+t(a.getDate())}const i={name:"ReportTeaching",components:{V2SimpleDate:()=>o(()=>import("./V2SimpleDate-11821f76.js"),["assets/V2SimpleDate-11821f76.js","assets/index-67337038.js","assets/index-f5f188af.css","assets/V2SimpleDate-9b3aafb8.css"])},data(){return{startDate:"",endDate:"",top:5,loadingRank:!1,classRank:[],tStart:"",tEnd:"",loadingHours:!1,teacherHours:[]}},computed:{columnsRank(){return[{title:"班级",dataIndex:"className",key:"className"},{title:"平均出勤率(%)",dataIndex:"avgAttendanceRate",key:"avgAttendanceRate"}]},columnsHours(){return[{title:"教师ID",dataIndex:"teacherId",key:"teacherId"},{title:"总课时(小时)",dataIndex:"totalHours",key:"totalHours"}]}},methods:{async loadClassRank(){this.loadingRank=!0;try{const e=new URLSearchParams;this.startDate&&e.append("startDate",s(this.startDate)),this.endDate&&e.append("endDate",s(this.endDate)),this.top&&e.append("top",String(this.top));const a=await(await fetch("/api/report/teaching/class-attendance-rank?"+e.toString())).json();this.classRank=a&&a.code===200?a.data||[]:[]}finally{this.loadingRank=!1}},async loadTeacherHours(){this.loadingHours=!0;try{const e=new URLSearchParams;this.tStart&&e.append("startDate",s(this.tStart)),this.tEnd&&e.append("endDate",s(this.tEnd));const a=await(await fetch("/api/report/teaching/teacher-hours?"+e.toString())).json();this.teacherHours=a&&a.code===200?a.data||[]:[]}finally{this.loadingHours=!1}},exportClassRank(){const e=new URLSearchParams;this.startDate&&e.append("startDate",s(this.startDate)),this.endDate&&e.append("endDate",s(this.endDate)),this.top&&e.append("top",String(this.top)),window.open("/api/report/export/class-attendance-rank.csv?"+e.toString(),"_blank")},exportTeacherHours(){const e=new URLSearchParams;this.tStart&&e.append("startDate",s(this.tStart)),this.tEnd&&e.append("endDate",s(this.tEnd)),window.open("/api/report/export/teacher-hours.csv?"+e.toString(),"_blank")}},mounted(){this.loadClassRank(),this.loadTeacherHours()}};var l=function(){var t=this,a=t._self._c;return a("div",{staticStyle:{background:"#fff",padding:"16px"}},[a("h2",[t._v("教学报表")]),a("a-space",{staticStyle:{"margin-bottom":"12px"}},[a("V2SimpleDate",{attrs:{type:"date",format:"YYYY-MM-DD",placeholder:"开始日期"},model:{value:t.startDate,callback:function(n){t.startDate=n},expression:"startDate"}}),a("V2SimpleDate",{attrs:{type:"date",format:"YYYY-MM-DD",placeholder:"结束日期"},model:{value:t.endDate,callback:function(n){t.endDate=n},expression:"endDate"}}),a("a-input-number",{staticStyle:{width:"120px"},attrs:{min:1,max:20,placeholder:"TopN"},model:{value:t.top,callback:function(n){t.top=n},expression:"top"}}),a("a-button",{attrs:{type:"primary",loading:t.loadingRank},on:{click:t.loadClassRank}},[t._v("加载班级出勤排行")]),a("a-button",{attrs:{disabled:t.loadingRank},on:{click:t.exportClassRank}},[t._v("导出排行CSV")])],1),a("a-table",{attrs:{"data-source":t.classRank,columns:t.columnsRank,pagination:!1,rowKey:"classId"}}),a("h3",{staticStyle:{"margin-top":"24px"}},[t._v("教师课时统计")]),a("a-space",{staticStyle:{"margin-bottom":"8px"}},[a("V2SimpleDate",{attrs:{type:"date",format:"YYYY-MM-DD",placeholder:"开始日期"},model:{value:t.tStart,callback:function(n){t.tStart=n},expression:"tStart"}}),a("V2SimpleDate",{attrs:{type:"date",format:"YYYY-MM-DD",placeholder:"结束日期"},model:{value:t.tEnd,callback:function(n){t.tEnd=n},expression:"tEnd"}}),a("a-button",{attrs:{type:"primary",loading:t.loadingHours},on:{click:t.loadTeacherHours}},[t._v("加载教师课时")]),a("a-button",{attrs:{disabled:t.loadingHours},on:{click:t.exportTeacherHours}},[t._v("导出课时CSV")])],1),a("a-table",{attrs:{"data-source":t.teacherHours,columns:t.columnsHours,pagination:!1,rowKey:"teacherId"}})],1)},c=[],d=r(i,l,c,!1,null,"760036d0",null,null);const h=d.exports;export{h as default};
