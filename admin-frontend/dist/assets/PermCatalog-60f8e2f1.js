import{n as r}from"./index-67337038.js";const l={name:"PermCatalog",data(){return{query:{type:"menu",keyword:""},loading:!1,list:[],columns:[{title:"类型",dataIndex:"type"},{title:"标签",dataIndex:"label"},{title:"值",dataIndex:"value"},{title:"排序",dataIndex:"sortOrder"},{title:"操作",key:"actions",scopedSlots:{customRender:"actions"}}],editVisible:!1,editMode:"add",saving:!1,form:{id:null,type:"menu",label:"",value:"",sortOrder:0},rolesVisible:!1,roles:[],initLoading:!1}},created(){this.loadList()},methods:{async loadList(){this.loading=!0;const s=this.query.type?"?type="+encodeURIComponent(this.query.type):"";try{const t=await(await fetch("/api/base/perm/catalog/items"+s)).json();let a=Array.isArray(t.data)?t.data:[];if(this.query.keyword){const i=String(this.query.keyword).toLowerCase();a=a.filter(o=>String(o.label||"").toLowerCase().includes(i)||String(o.value||"").toLowerCase().includes(i))}this.list=a}catch{this.list=[]}this.loading=!1},openAdd(){this.editMode="add",this.form={id:null,type:"menu",label:"",value:"",sortOrder:0},this.editVisible=!0},openEdit(s){s&&(this.editMode="edit",this.form={id:s.id,type:s.type,label:s.label,value:s.value,sortOrder:s.sortOrder},this.editVisible=!0)},async doSave(){if(!this.form.type||!this.form.label||!this.form.value){this.$message&&this.$message.warning("请填写完整信息");return}this.saving=!0;try{if(this.editMode==="add"){const e=await(await fetch("/api/base/perm/catalog/save",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(this.form)})).json();if(e&&e.code===200)this.$message&&this.$message.success("已新增"),this.editVisible=!1,this.loadList();else throw new Error(e.message||"新增失败")}else{const e=await(await fetch("/api/base/perm/catalog/update/"+this.form.id,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(this.form)})).json();if(e&&e.code===200)this.$message&&this.$message.success("已更新"),this.editVisible=!1,this.loadList();else throw new Error(e.message||"更新失败")}}catch(s){this.$message&&this.$message.error(s.message||"保存失败")}this.saving=!1},async doDelete(s){if(!(!s||!s.id))try{const t=await(await fetch("/api/base/perm/catalog/delete/"+s.id,{method:"DELETE"})).json();t&&t.code===200?(this.$message&&this.$message.success("已删除"),this.loadList()):this.$message&&this.$message.error(t.message||"删除失败")}catch{this.$message&&this.$message.error("删除失败")}},async viewRoles(s){if(!s||!s.value){this.rolesVisible=!0,this.roles=[];return}try{const t=await(await fetch("/api/base/perm/catalog/roles?value="+encodeURIComponent(s.value))).json();this.roles=Array.isArray(t.data)?t.data:[]}catch{this.roles=[]}this.rolesVisible=!0},async initPermissions(){this.initLoading=!0;try{const e=await(await fetch("/api/system/init/permissions",{method:"POST"})).json();if(e&&e.code===200)this.$message&&this.$message.success("权限目录已初始化"),this.loadList();else throw new Error(e.message||"初始化失败")}catch(s){this.$message&&this.$message.error(s.message||"初始化失败")}this.initLoading=!1}}};var n=function(){var e=this,t=e._self._c;return t("div",{staticClass:"perm-catalog"},[t("a-page-header",{attrs:{title:"权限目录管理","sub-title":"维护菜单/按钮/数据权限，支持初始化与角色关联查看"}}),t("a-card",{staticStyle:{"margin-bottom":"12px"},attrs:{bordered:""}},[t("a-space",[t("a-select",{staticStyle:{width:"160px"},attrs:{placeholder:"选择类型",allowClear:""},on:{change:e.loadList},model:{value:e.query.type,callback:function(a){e.$set(e.query,"type",a)},expression:"query.type"}},[t("a-select-option",{attrs:{value:"menu"}},[e._v("menu")]),t("a-select-option",{attrs:{value:"button"}},[e._v("button")]),t("a-select-option",{attrs:{value:"data"}},[e._v("data")])],1),t("a-input",{staticStyle:{width:"240px"},attrs:{placeholder:"按标签或值搜索"},on:{pressEnter:e.loadList},model:{value:e.query.keyword,callback:function(a){e.$set(e.query,"keyword",a)},expression:"query.keyword"}}),t("a-button",{attrs:{type:"primary"},on:{click:e.openAdd}},[e._v("新增")]),t("a-button",{on:{click:e.loadList}},[e._v("刷新")]),t("a-divider",{attrs:{type:"vertical"}}),t("a-button",{attrs:{loading:e.initLoading},on:{click:e.initPermissions}},[e._v("初始化权限目录")])],1)],1),t("a-card",{attrs:{bordered:""}},[t("a-table",{attrs:{"data-source":e.list,columns:e.columns,rowKey:"id",loading:e.loading},scopedSlots:e._u([{key:"actions",fn:function(a,i){return[t("a-space",[t("a-button",{attrs:{size:"small"},on:{click:function(o){return e.openEdit(i)}}},[e._v("编辑")]),t("a-button",{attrs:{size:"small"},on:{click:function(o){return e.viewRoles(i)}}},[e._v("关联角色")]),t("a-popconfirm",{attrs:{title:"确认删除？删除前需确保未关联任何角色"},on:{confirm:function(o){return e.doDelete(i)}}},[t("a-button",{attrs:{size:"small",danger:""}},[e._v("删除")])],1)],1)]}}])})],1),t("a-modal",{attrs:{title:e.editMode==="add"?"新增权限项":"编辑权限项","confirm-loading":e.saving,width:520},on:{ok:e.doSave,cancel:()=>{e.editVisible=!1}},model:{value:e.editVisible,callback:function(a){e.editVisible=a},expression:"editVisible"}},[t("a-form",{attrs:{layout:"horizontal","label-col":{span:6},"wrapper-col":{span:16}}},[t("a-form-item",{attrs:{label:"类型"}},[t("a-select",{model:{value:e.form.type,callback:function(a){e.$set(e.form,"type",a)},expression:"form.type"}},[t("a-select-option",{attrs:{value:"menu"}},[e._v("menu")]),t("a-select-option",{attrs:{value:"button"}},[e._v("button")]),t("a-select-option",{attrs:{value:"data"}},[e._v("data")])],1)],1),t("a-form-item",{attrs:{label:"标签"}},[t("a-input",{model:{value:e.form.label,callback:function(a){e.$set(e.form,"label",a)},expression:"form.label"}})],1),t("a-form-item",{attrs:{label:"值"}},[t("a-input",{attrs:{placeholder:"如 menu:finance:settlement:fee 或 base:campus:add"},model:{value:e.form.value,callback:function(a){e.$set(e.form,"value",a)},expression:"form.value"}})],1),t("a-form-item",{attrs:{label:"排序"}},[t("a-input-number",{attrs:{min:0},model:{value:e.form.sortOrder,callback:function(a){e.$set(e.form,"sortOrder",a)},expression:"form.sortOrder"}})],1)],1)],1),t("a-modal",{attrs:{title:"关联角色",footer:null,width:520},model:{value:e.rolesVisible,callback:function(a){e.rolesVisible=a},expression:"rolesVisible"}},[t("a-list",{attrs:{"data-source":e.roles,bordered:""}},e._l(e.roles,function(a){return t("a-list-item",{key:a.id},[e._v(e._s(a.name)+"（"+e._s(a.code)+"）")])}),1),!e.roles||e.roles.length===0?t("div",{staticStyle:{color:"#999",padding:"8px 0"}},[e._v("暂无关联角色")]):e._e()],1)],1)},d=[],c=r(l,n,d,!1,null,"a28616d7",null,null);const u=c.exports;export{u as default};
