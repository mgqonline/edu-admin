import{n as l,_ as c,h as o}from"./index-67337038.js";const d={name:"AttendanceStat",components:{CompatDatePicker:()=>c(()=>import("./CompatDatePicker-77afd840.js"),["assets/CompatDatePicker-77afd840.js","assets/index-67337038.js","assets/index-f5f188af.css","assets/ReportEnroll-e3b0c442.css"])},data(){return{activeTab:"student",studentId:"",startDate:null,endDate:null,studentStats:{},classId:"",month:"",classStats:{},classTrendRange:"week",classTrendPoints:[],classTrendColumns:[{title:"日期/周",dataIndex:"label"},{title:"出勤率(%)",dataIndex:"rate"}],teacherId:"",startDateT:null,endDateT:null,teacherStats:{},weekReport:{},weeklyPreviewVisible:!1,weeklyPreviewTitle:"",weeklyPreviewContent:""}},methods:{noop(){},fmtDate(s){if(!s)return"";if(typeof s=="string")return s;try{return s.format?s.format("YYYY-MM-DD"):o(s).format("YYYY-MM-DD")}catch{return""}},async loadStudentStats(){if(!this.studentId){this.$message.warning("请输入学员ID");return}const s=new URLSearchParams({studentId:this.studentId,startDate:this.fmtDate(this.startDate),endDate:this.fmtDate(this.endDate)}),t=await(await fetch("/api/attendance/student/stats?"+s.toString())).json();this.studentStats=t&&t.code===200?t.data||{}:{}},async loadClassStats(){if(!this.classId||!this.month){this.$message.warning("请输入班级ID与月份");return}const s=new URLSearchParams({classId:this.classId,month:this.month}),t=await(await fetch("/api/attendance/class/stats?"+s.toString())).json();this.classStats=t&&t.code===200?t.data||{}:{}},async loadClassTrend(){if(!this.classId){this.$message.warning("请输入班级ID");return}const s=new URLSearchParams({classId:this.classId,range:this.classTrendRange,month:this.month}),t=await(await fetch("/api/attendance/class/trend?"+s.toString())).json(),e=t&&t.code===200?t.data||{}:{},r=Array.isArray(e.points)?e.points:[];this.classTrendPoints=r.map((n,i)=>({key:i,label:n.date||n.week||"-",rate:n.rate||0}))},async loadTeacherStats(){if(!this.teacherId){this.$message.warning("请输入教师ID");return}const s=new URLSearchParams({teacherId:this.teacherId,startDate:this.fmtDate(this.startDateT),endDate:this.fmtDate(this.endDateT)}),t=await(await fetch("/api/attendance/teacher/stats?"+s.toString())).json();this.teacherStats=t&&t.code===200?t.data||{}:{}},async loadWeekOverview(){const a=await(await fetch("/api/report/attendance/week")).json();this.weekReport=a&&a.code===200?a.data||{}:{}},async previewWeeklyNotify(){try{const s=new URLSearchParams({}),t=await(await fetch("/api/notify/preview/weekly?"+s.toString())).json(),e=t&&t.code===200?t.data||{}:{};this.weeklyPreviewTitle=e.title||"周报通知预览",this.weeklyPreviewContent=e.content||"",this.weeklyPreviewVisible=!0}catch{this.$message&&this.$message.error("预览失败")}}}};var p=function(){var a=this,t=a._self._c;return t("div",{staticClass:"attendance-stat-container"},[t("div",{staticClass:"page-title"},[a._v("签到与考勤统计")]),t("a-tabs",{model:{value:a.activeTab,callback:function(e){a.activeTab=e},expression:"activeTab"}},[t("a-tab-pane",{key:"student",attrs:{tab:"学员统计"}},[t("a-space",{staticStyle:{width:"100%"},attrs:{direction:"vertical"}},[t("a-row",{attrs:{gutter:12}},[t("a-col",{attrs:{sm:8,xs:24}},[t("a-input",{attrs:{placeholder:"学员ID"},model:{value:a.studentId,callback:function(e){a.studentId=e},expression:"studentId"}})],1),t("a-col",{attrs:{sm:8,xs:24}},[t("CompatDatePicker",{staticStyle:{width:"100%"},attrs:{placeholder:"开始日期"},model:{value:a.startDate,callback:function(e){a.startDate=e},expression:"startDate"}})],1),t("a-col",{attrs:{sm:8,xs:24}},[t("CompatDatePicker",{staticStyle:{width:"100%"},attrs:{placeholder:"结束日期"},model:{value:a.endDate,callback:function(e){a.endDate=e},expression:"endDate"}})],1)],1),t("a-space",[t("a-button",{attrs:{type:"primary"},on:{click:a.loadStudentStats}},[a._v("查询")])],1),t("a-row",{staticStyle:{"margin-top":"12px"},attrs:{gutter:16}},[t("a-col",{attrs:{span:6}},[t("a-statistic",{attrs:{title:"总课时",value:a.studentStats.totalHours||0}})],1),t("a-col",{attrs:{span:6}},[t("a-statistic",{attrs:{title:"完成课时",value:a.studentStats.completedHours||0}})],1),t("a-col",{attrs:{span:6}},[t("a-statistic",{attrs:{title:"缺勤次数",value:a.studentStats.absent||0}})],1),t("a-col",{attrs:{span:6}},[t("a-statistic",{attrs:{title:"迟到次数",value:a.studentStats.late||0}})],1)],1),t("a-row",{staticStyle:{"margin-top":"12px"},attrs:{gutter:16}},[t("a-col",{attrs:{span:12}},[t("a-statistic",{attrs:{title:"报名课时",value:a.studentStats.enrolledHours||0}})],1),t("a-col",{attrs:{span:12}},[t("a-statistic",{attrs:{title:"剩余课时",value:a.studentStats.remainingHours||0}})],1)],1)],1)],1),t("a-tab-pane",{key:"class",attrs:{tab:"班级统计"}},[t("a-space",{staticStyle:{width:"100%"},attrs:{direction:"vertical"}},[t("a-row",{attrs:{gutter:12}},[t("a-col",{attrs:{sm:12,xs:24}},[t("a-input",{attrs:{placeholder:"班级ID"},model:{value:a.classId,callback:function(e){a.classId=e},expression:"classId"}})],1),t("a-col",{attrs:{sm:12,xs:24}},[t("a-input",{attrs:{placeholder:"月份(YYYY-MM)"},model:{value:a.month,callback:function(e){a.month=e},expression:"month"}})],1)],1),t("a-button",{attrs:{type:"primary"},on:{click:a.loadClassStats}},[a._v("查询")]),t("a-row",{staticStyle:{"margin-top":"12px"},attrs:{gutter:16}},[t("a-col",{attrs:{span:8}},[t("a-statistic",{attrs:{title:"平均出勤率",value:a.classStats.avgAttendanceRate||0,suffix:"%"}})],1),t("a-col",{attrs:{span:16}},[t("div",[a._v("缺勤TOP3："+a._s((a.classStats.absentTop3||[]).join("，")))])])],1),t("a-divider"),t("a-row",{attrs:{gutter:12}},[t("a-col",{attrs:{sm:8,xs:24}},[t("a-select",{staticStyle:{width:"100%"},model:{value:a.classTrendRange,callback:function(e){a.classTrendRange=e},expression:"classTrendRange"}},[t("a-select-option",{attrs:{value:"week"}},[a._v("周度趋势(最近8周)")]),t("a-select-option",{attrs:{value:"month"}},[a._v("月度趋势(当月)")])],1)],1),a.classTrendRange==="month"?t("a-col",{attrs:{sm:8,xs:24}},[t("a-input",{attrs:{placeholder:"月份(YYYY-MM)"},model:{value:a.month,callback:function(e){a.month=e},expression:"month"}})],1):a._e(),t("a-col",{attrs:{sm:8,xs:24}},[t("a-button",{on:{click:a.loadClassTrend}},[a._v("加载趋势")])],1)],1),t("a-table",{staticStyle:{"margin-top":"8px"},attrs:{"data-source":a.classTrendPoints,columns:a.classTrendColumns,rowKey:"key",pagination:!1}})],1)],1),t("a-tab-pane",{key:"teacher",attrs:{tab:"教师统计"}},[t("a-space",{staticStyle:{width:"100%"},attrs:{direction:"vertical"}},[t("a-row",{attrs:{gutter:12}},[t("a-col",{attrs:{sm:8,xs:24}},[t("a-input",{attrs:{placeholder:"教师ID"},model:{value:a.teacherId,callback:function(e){a.teacherId=e},expression:"teacherId"}})],1),t("a-col",{attrs:{sm:8,xs:24}},[t("CompatDatePicker",{staticStyle:{width:"100%"},attrs:{placeholder:"开始日期"},model:{value:a.startDateT,callback:function(e){a.startDateT=e},expression:"startDateT"}})],1),t("a-col",{attrs:{sm:8,xs:24}},[t("CompatDatePicker",{staticStyle:{width:"100%"},attrs:{placeholder:"结束日期"},model:{value:a.endDateT,callback:function(e){a.endDateT=e},expression:"endDateT"}})],1)],1),t("a-button",{attrs:{type:"primary"},on:{click:a.loadTeacherStats}},[a._v("查询")]),t("a-row",{staticStyle:{"margin-top":"12px"},attrs:{gutter:16}},[t("a-col",{attrs:{span:8}},[t("a-statistic",{attrs:{title:"整体出勤率",value:a.teacherStats.overallAttendanceRate||0,suffix:"%"}})],1),t("a-col",{attrs:{span:8}},[t("a-statistic",{attrs:{title:"签到发起及时率",value:a.teacherStats.signStartTimelyRate||0,suffix:"%"}})],1),t("a-col",{attrs:{span:8}},[t("a-statistic",{attrs:{title:"平均发起延迟",value:a.teacherStats.signStartAvgDelayMinutes||0,suffix:"分钟"}})],1)],1)],1)],1),t("a-tab-pane",{key:"overview",attrs:{tab:"周报概览"}},[t("a-space",{staticStyle:{width:"100%"},attrs:{direction:"vertical"}},[t("a-button",{on:{click:a.loadWeekOverview}},[a._v("加载周出勤概览")]),t("div",{staticStyle:{"margin-top":"8px"}},[a._v("周范围："+a._s(a.weekReport.week||"-")+"；平均出勤率："+a._s(a.weekReport.avgRate||"-")+"%")]),t("a-space",{staticStyle:{"margin-top":"8px"}},[t("a-button",{on:{click:a.previewWeeklyNotify}},[a._v("周报通知预览")])],1)],1)],1)],1),t("a-modal",{attrs:{title:a.weeklyPreviewTitle,footer:null},model:{value:a.weeklyPreviewVisible,callback:function(e){a.weeklyPreviewVisible=e},expression:"weeklyPreviewVisible"}},[t("div",{staticStyle:{"white-space":"pre-wrap"}},[a._v(a._s(a.weeklyPreviewContent))])])],1)},u=[],h=l(d,p,u,!1,null,null,null,null);const v=h.exports;export{v as default};
