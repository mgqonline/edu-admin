import{n as s,_ as r}from"./index-67337038.js";const o={name:"HolidayManage",components:{CompatDatePicker:()=>r(()=>import("./CompatDatePicker-77afd840.js"),["assets/CompatDatePicker-77afd840.js","assets/index-67337038.js","assets/index-f5f188af.css","assets/ReportEnroll-e3b0c442.css"])},data(){const e=new Date().getFullYear();return{loading:!1,submitting:!1,list:[],yearOptions:[e-1,e,e+1,e+2],query:{year:e,range:null},createVisible:!1,editVisible:!1,createForm:{date:null,name:""},editForm:{id:null,date:null,name:""},columns:[{title:"日期",dataIndex:"dateOnly",customRender:t=>this.formatDate(t)},{title:"名称",dataIndex:"name"},{title:"操作",key:"action",customRender:(t,i)=>this.$createElement("span",[this.$createElement("a",{directives:[{name:"perm",value:"base:holiday:edit"}],on:{click:()=>this.openEdit(i)}},"编辑"),this.$createElement("span",{style:{margin:"0 8px"}},"|"),this.$createElement("a",{directives:[{name:"perm",value:"base:holiday:delete"}],on:{click:()=>this.remove(i)}},"删除")])}]}},created(){this.loadList()},methods:{noop(){},onRangeChange(a,e){this.query.range=Array.isArray(e)&&e[0]&&e[1]?e:null},formatDate(a){try{return new Date(a).toISOString().slice(0,10)}catch{return a}},ymd(a){if(!a)return"";if(typeof a=="string")return a;if(a&&a.format)return a.format("YYYY-MM-DD");try{return a.toISOString().slice(0,10)}catch{return""}},async loadList(){this.loading=!0;try{let a="/api/base/holiday/list";const e=[];this.query.year&&e.push("year="+this.query.year),this.query.range&&this.query.range.length===2&&(e.push("start="+this.ymd(this.query.range[0])),e.push("end="+this.ymd(this.query.range[1]))),e.length&&(a+="?"+e.join("&"));const i=await(await fetch(a,{headers:{Authorization:"Bearer "+(localStorage.getItem("AUTH_TOKEN")||"")}})).json();i&&i.code===200?this.list=i.data||[]:(this.list=[],this.$message.error(i.message||"加载失败"))}catch{this.$message.error("加载失败")}finally{this.loading=!1}},resetQuery(){this.query={year:new Date().getFullYear(),range:null},this.loadList()},openCreate(){this.createVisible=!0,this.createForm={date:null,name:""}},openEdit(a){this.editVisible=!0,this.editForm={id:a.id,date:new Date(a.dateOnly),name:a.name}},async submitCreate(){this.submitting=!0;try{const a={date:this.ymd(this.createForm.date),name:this.createForm.name},t=await(await fetch("/api/base/holiday/create",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+(localStorage.getItem("AUTH_TOKEN")||"")},body:JSON.stringify(a)})).json();if(!(t&&t.code===200))throw new Error(t.message||"新增失败");this.createVisible=!1,this.$message.success("新增成功"),this.loadList()}catch(a){this.$message.error(a.message||"新增失败")}finally{this.submitting=!1}},async submitEdit(){this.submitting=!0;try{const a={date:this.ymd(this.editForm.date),name:this.editForm.name},t=await(await fetch(`/api/base/holiday/update/${this.editForm.id}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer "+(localStorage.getItem("AUTH_TOKEN")||"")},body:JSON.stringify(a)})).json();if(!(t&&t.code===200))throw new Error(t.message||"更新失败");this.editVisible=!1,this.$message.success("更新成功"),this.loadList()}catch(a){this.$message.error(a.message||"更新失败")}finally{this.submitting=!1}},async remove(a){try{const t=await(await fetch(`/api/base/holiday/delete/${a.id}`,{method:"DELETE",headers:{Authorization:"Bearer "+(localStorage.getItem("AUTH_TOKEN")||"")}})).json();t&&t.code===200?(this.$message.success("删除成功"),this.loadList()):this.$message.error(t.message||"删除失败")}catch{this.$message.error("删除失败")}}}};var n=function(){var e=this,t=e._self._c;return t("div",{staticStyle:{background:"#fff",padding:"16px"}},[t("a-page-header",{attrs:{title:"节假日管理","sub-title":"维护法定节假日，供排课跳过"}}),t("a-card",{staticStyle:{"margin-bottom":"16px"},attrs:{bordered:"",title:"查询与新增"}},[t("a-form",{attrs:{layout:"inline"}},[t("a-form-item",{attrs:{label:"年份"}},[t("a-select",{staticStyle:{width:"120px"},attrs:{allowClear:"",placeholder:"选择年份"},model:{value:e.query.year,callback:function(i){e.$set(e.query,"year",i)},expression:"query.year"}},e._l(e.yearOptions,function(i){return t("a-select-option",{key:i,attrs:{value:i}},[e._v(e._s(i))])}),1)],1),t("a-form-item",{attrs:{label:"日期范围"}},[t("a-range-picker",{staticStyle:{width:"240px"},attrs:{value:e.query.range},on:{change:e.onRangeChange}})],1),t("a-form-item",[t("a-space",[t("a-button",{attrs:{type:"primary",loading:e.loading},on:{click:e.loadList}},[e._v("查询")]),t("a-button",{on:{click:e.resetQuery}},[e._v("重置")])],1)],1)],1),t("a-divider"),t("a-space",[t("a-button",{directives:[{name:"perm",rawName:"v-perm",value:"base:holiday:add",expression:"'base:holiday:add'"}],attrs:{type:"primary"},on:{click:e.openCreate}},[e._v("新增节假日")]),t("a-button",{attrs:{loading:e.loading},on:{click:e.loadList}},[e._v("刷新")])],1)],1),t("a-table",{attrs:{"data-source":e.list,columns:e.columns,rowKey:"id",loading:e.loading}}),t("a-modal",{attrs:{visible:e.createVisible,title:"新增节假日",confirmLoading:e.submitting},on:{ok:e.submitCreate,cancel:function(i){e.createVisible=!1}}},[t("a-form",{attrs:{layout:"vertical"}},[t("a-form-item",{attrs:{label:"日期"}},[t("CompatDatePicker",{staticStyle:{width:"100%"},model:{value:e.createForm.date,callback:function(i){e.$set(e.createForm,"date",i)},expression:"createForm.date"}})],1),t("a-form-item",{attrs:{label:"名称"}},[t("a-input",{attrs:{placeholder:"如：国庆节"},model:{value:e.createForm.name,callback:function(i){e.$set(e.createForm,"name",i)},expression:"createForm.name"}})],1)],1)],1),t("a-modal",{attrs:{visible:e.editVisible,title:"编辑节假日",confirmLoading:e.submitting},on:{ok:e.submitEdit,cancel:function(i){e.editVisible=!1}}},[t("a-form",{attrs:{layout:"vertical"}},[t("a-form-item",{attrs:{label:"日期"}},[t("CompatDatePicker",{staticStyle:{width:"100%"},model:{value:e.editForm.date,callback:function(i){e.$set(e.editForm,"date",i)},expression:"editForm.date"}})],1),t("a-form-item",{attrs:{label:"名称"}},[t("a-input",{model:{value:e.editForm.name,callback:function(i){e.$set(e.editForm,"name",i)},expression:"editForm.name"}})],1)],1)],1)],1)},l=[],c=s(o,n,l,!1,null,"d3e8cad1",null,null);const d=c.exports;export{d as default};
