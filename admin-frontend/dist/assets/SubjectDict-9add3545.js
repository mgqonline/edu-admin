import{n as r}from"./index-67337038.js";const o={name:"SubjectDictPage",data(){return{loading:!1,submitting:!1,list:[],filters:{status:""},form:{name:"",status:"enabled",sortOrder:0},columns:[{title:"名称",dataIndex:"name",key:"name"},{title:"状态",dataIndex:"status",key:"status",scopedSlots:{customRender:"status"}},{title:"排序",dataIndex:"sortOrder",key:"sortOrder"},{title:"操作",key:"action",scopedSlots:{customRender:"action"}}]}},created(){this.loadData()},methods:{async loadData(){this.loading=!0;try{const e=new URLSearchParams;this.filters.status&&e.append("status",this.filters.status);const s=await(await fetch(`/api/dict/subject/list${e.toString()?"?"+e.toString():""}`)).json();s&&s.code===200?this.list=s.data||[]:this.list=[]}catch{this.list=[]}finally{this.loading=!1}},async submit(){if(!this.form.name){this.$message&&this.$message.warning("请输入科目名称");return}this.submitting=!0;try{const t=await(await fetch("/api/dict/subject/save",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:this.form.name,status:this.form.status,sortOrder:this.form.sortOrder})})).json();t&&t.code===200?(this.$message&&this.$message.success("保存成功"),this.form={name:"",status:"enabled",sortOrder:0},this.loadData()):this.$message&&this.$message.error(t.message||"保存失败")}catch{this.$message&&this.$message.error("保存失败")}finally{this.submitting=!1}},async toggleStatus(e){if(!(!e||!e.name))try{const t=e.status==="enabled"?"disabled":"enabled",a=await(await fetch("/api/dict/subject/save",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:e.name,status:t,sortOrder:e.sortOrder||0})})).json();if(a&&a.code===200)this.$message&&this.$message.success("状态已更新"),this.loadData();else throw new Error("更新失败")}catch{this.$message&&this.$message.error("更新失败")}},async updateSort(e){if(!(!e||!e.name))try{const s=await(await fetch("/api/dict/subject/save",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:e.name,status:e.status||"enabled",sortOrder:Number(e.sortOrder||0)})})).json();if(s&&s.code===200)this.$message&&this.$message.success("排序已更新"),this.loadData();else throw new Error("更新失败")}catch{this.$message&&this.$message.error("更新失败")}}}};var l=function(){var t=this,s=t._self._c;return s("div",{staticClass:"subject-dict-page"},[s("a-page-header",{attrs:{title:"科目维护","sub-title":"维护科目字典（名称、状态、排序）"}}),s("a-card",{attrs:{bordered:""}},[s("a-space",{staticStyle:{"margin-bottom":"12px"},attrs:{wrap:""}},[s("a-input",{staticStyle:{width:"200px"},attrs:{placeholder:"科目名称"},model:{value:t.form.name,callback:function(a){t.$set(t.form,"name",a)},expression:"form.name"}}),s("a-select",{staticStyle:{width:"140px"},model:{value:t.form.status,callback:function(a){t.$set(t.form,"status",a)},expression:"form.status"}},[s("a-select-option",{attrs:{value:"enabled"}},[t._v("启用")]),s("a-select-option",{attrs:{value:"disabled"}},[t._v("禁用")])],1),s("a-input-number",{staticStyle:{width:"120px"},attrs:{min:0,max:999},model:{value:t.form.sortOrder,callback:function(a){t.$set(t.form,"sortOrder",a)},expression:"form.sortOrder"}}),s("a-button",{attrs:{type:"primary",loading:t.submitting},on:{click:t.submit}},[t._v("保存")]),s("a-select",{staticStyle:{width:"160px"},attrs:{placeholder:"状态筛选",allowClear:""},on:{change:t.loadData},model:{value:t.filters.status,callback:function(a){t.$set(t.filters,"status",a)},expression:"filters.status"}},[s("a-select-option",{attrs:{value:"enabled"}},[t._v("启用")]),s("a-select-option",{attrs:{value:"disabled"}},[t._v("禁用")])],1),s("a-button",{attrs:{loading:t.loading},on:{click:t.loadData}},[t._v("刷新")])],1),s("a-table",{attrs:{"data-source":t.list,columns:t.columns,rowKey:"id",pagination:!1},scopedSlots:t._u([{key:"status",fn:function(a){return[s("a-tag",{attrs:{color:a==="enabled"?"green":"red"}},[t._v(" "+t._s(a==="enabled"?"启用":"禁用")+" ")])]}},{key:"action",fn:function(a,n){return[s("a-space",[s("a-button",{attrs:{size:"small"},on:{click:function(i){return t.toggleStatus(n)}}},[t._v(" "+t._s(n&&n.status==="enabled"?"禁用":"启用")+" ")]),s("a-popconfirm",{attrs:{title:"更新排序？"},on:{confirm:function(i){return t.updateSort(n)}}},[s("a-button",{attrs:{size:"small"}},[t._v("更新排序")])],1)],1)]}}])})],1)],1)},c=[],u=r(o,l,c,!1,null,null,null,null);const m=u.exports;export{m as default};
