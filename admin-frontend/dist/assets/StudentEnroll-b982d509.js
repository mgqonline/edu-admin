import{n}from"./index-67337038.js";const o={name:"StudentEnroll",data(){return{form:{studentId:null,classId:null,fee:0,approvalRequired:!1,applyInfo:""},list:[],columns:[{title:"ID",dataIndex:"id",key:"id"},{title:"学员ID",dataIndex:"studentId",key:"studentId"},{title:"班级ID",dataIndex:"classId",key:"classId"},{title:"费用",dataIndex:"fee",key:"fee"},{title:"教材费",dataIndex:"materialsFee",key:"materialsFee"},{title:"状态",dataIndex:"status",key:"status",scopedSlots:{customRender:"status"}},{title:"合同",dataIndex:"contractUrl",key:"contractUrl"},{title:"签署",dataIndex:"signed",key:"signed"},{title:"操作",key:"action",scopedSlots:{customRender:"action"}}]}},methods:{readQuery(){try{const a=this.$route&&this.$route.query||{};a.studentId&&(this.form.studentId=Number(a.studentId)),a.recommend&&(this.form.applyInfo=String(a.recommend))}catch{}},async apply(){if(!this.form.studentId||!this.form.classId){this.$message&&this.$message.error("请填写学员ID与班级ID");return}try{const t=await(await fetch("/api/enroll/apply",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(this.form)})).json();t.code===200?(this.$message&&this.$message.success("报名成功"),await this.loadList()):this.$message&&this.$message.error("报名失败："+(t.msg||"未知错误"))}catch{this.$message&&this.$message.error("报名异常")}},async loadList(){const a=[];this.form.studentId&&a.push("studentId="+encodeURIComponent(this.form.studentId));const t="/api/enroll/list"+(a.length?"?"+a.join("&"):"");try{const s=await(await fetch(t)).json();this.list=Array.isArray(s.data)?s.data:[]}catch{this.list=[]}},async loadLast(){if(!this.form.studentId){this.$message&&this.$message.warning("请先填写学员ID");return}try{const t=await(await fetch(`/api/enroll/last?studentId=${encodeURIComponent(this.form.studentId)}`)).json();t.code===200?(this.$message&&this.$message.success("已获取最新报名"),this.list=[t.data].concat(this.list)):this.$message&&this.$message.error("未找到最新报名")}catch{}},async genContract(a){try{(await(await fetch("/api/enroll/contract/generate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({enrollId:a.id})})).json()).code===200?(this.$message&&this.$message.success("合同已生成"),await this.loadList()):this.$message&&this.$message.error("生成失败")}catch{}},async approve(a,t){try{const s=await(await fetch("/api/enroll/approve",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({enrollId:a.id,action:t})})).json();s.code===200?(this.$message&&this.$message.success(t==="approve"?"已通过":"已驳回"),await this.loadList()):this.$message&&this.$message.error(s.msg||"失败")}catch{}},async signContract(a){try{const e=await(await fetch("/api/enroll/contract/sign",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({enrollId:a.id})})).json();e.code===200?(this.$message&&this.$message.success("已签署"),await this.loadList()):this.$message&&this.$message.error(e.msg||"失败")}catch{}},async remove(a){try{const e=await(await fetch("/api/enroll/delete",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:a.id})})).json();e.code===200?(this.$message&&this.$message.success("已删除"),await this.loadList()):this.$message&&this.$message.error(e.msg||"失败")}catch{}}},async mounted(){this.readQuery(),await this.loadList()}};var i=function(){var t=this,e=t._self._c;return e("div",{staticClass:"student-enroll"},[e("a-page-header",{attrs:{title:"学员报名","sub-title":"选择班级、费用与审批/合同签署"}}),e("a-card",{staticStyle:{"margin-bottom":"12px"},attrs:{bordered:"",title:"报名信息"}},[e("a-form",{attrs:{"label-col":{span:6},"wrapper-col":{span:16}}},[e("a-row",{attrs:{gutter:16}},[e("a-col",{attrs:{span:6}},[e("a-form-item",{attrs:{label:"学员ID"}},[e("a-input-number",{staticStyle:{width:"100%"},attrs:{min:1,placeholder:"学员ID"},model:{value:t.form.studentId,callback:function(s){t.$set(t.form,"studentId",s)},expression:"form.studentId"}})],1)],1),e("a-col",{attrs:{span:6}},[e("a-form-item",{attrs:{label:"班级ID"}},[e("a-input-number",{staticStyle:{width:"100%"},attrs:{min:1,placeholder:"班级ID"},model:{value:t.form.classId,callback:function(s){t.$set(t.form,"classId",s)},expression:"form.classId"}})],1)],1),e("a-col",{attrs:{span:6}},[e("a-form-item",{attrs:{label:"费用(元)"}},[e("a-input-number",{staticStyle:{width:"100%"},attrs:{min:0,step:100,placeholder:"学费"},model:{value:t.form.fee,callback:function(s){t.$set(t.form,"fee",s)},expression:"form.fee"}})],1)],1),e("a-col",{attrs:{span:6}},[e("a-form-item",{attrs:{label:"需审批"}},[e("a-switch",{model:{value:t.form.approvalRequired,callback:function(s){t.$set(t.form,"approvalRequired",s)},expression:"form.approvalRequired"}})],1)],1)],1),e("a-form-item",{attrs:{label:"备注"}},[e("a-input",{attrs:{placeholder:"报名备注（将自动附加教材费说明）"},model:{value:t.form.applyInfo,callback:function(s){t.$set(t.form,"applyInfo",s)},expression:"form.applyInfo"}})],1),e("a-form-item",{attrs:{"wrapper-col":{span:16,offset:6}}},[e("a-space",[e("a-button",{attrs:{type:"primary"},on:{click:t.apply}},[t._v("申请报名")]),e("a-button",{on:{click:t.loadList}},[t._v("加载列表")]),e("a-button",{attrs:{type:"dashed"},on:{click:t.loadLast}},[t._v("获取最新报名")])],1)],1)],1)],1),e("a-card",{attrs:{bordered:"",title:"报名记录"}},[e("a-table",{attrs:{"data-source":t.list,columns:t.columns,rowKey:"id",pagination:!1},scopedSlots:t._u([{key:"status",fn:function(s){return[s&&s.record&&s.record.status==="pending"?e("a-tag",{attrs:{color:"orange"}},[t._v("待审批")]):s&&s.record&&s.record.status==="approved"?e("a-tag",{attrs:{color:"green"}},[t._v("已通过")]):s&&s.record&&s.record.status==="rejected"?e("a-tag",{attrs:{color:"red"}},[t._v("已驳回")]):e("a-tag",[t._v("未知")])]}},{key:"action",fn:function(s){return[s&&s.record?e("a-space",[e("a-button",{attrs:{size:"small"},on:{click:function(r){return t.genContract(s.record)}}},[t._v("生成合同")]),e("a-button",{attrs:{size:"small",disabled:!s.record.contractUrl},on:{click:function(r){return t.signContract(s.record)}}},[t._v("签署合同")]),e("a-button",{attrs:{size:"small",type:"primary",disabled:s.record.status!=="pending"},on:{click:function(r){return t.approve(s.record,"approve")}}},[t._v("审批通过")]),e("a-button",{attrs:{size:"small",type:"danger",disabled:s.record.status!=="pending"},on:{click:function(r){return t.approve(s.record,"reject")}}},[t._v("驳回")]),e("a-button",{attrs:{size:"small",type:"dashed"},on:{click:function(r){return t.remove(s.record)}}},[t._v("删除")])],1):e("span",[t._v("—")])]}}])})],1)],1)},c=[],d=n(o,i,c,!1,null,"082f1868",null,null);const m=d.exports;export{m as default};
