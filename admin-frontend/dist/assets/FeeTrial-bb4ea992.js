import{n as o,_ as r}from"./index-67337038.js";const n={name:"FeeTrial",components:{V2SimpleDate:()=>r(()=>import("./V2SimpleDate-11821f76.js"),["assets/V2SimpleDate-11821f76.js","assets/index-67337038.js","assets/index-f5f188af.css","assets/V2SimpleDate-9b3aafb8.css"])},data(){return{calculating:!1,result:null,campusLoading:!1,campusOptions:[],teacherLoading:!1,teacherOptions:[],columns:[{title:"课程类型",dataIndex:"courseType",key:"courseType",scopedSlots:{customRender:"courseType"}},{title:"课程类别",dataIndex:"courseCategory",key:"courseCategory",scopedSlots:{customRender:"courseCategory"}},{title:"班级人数",dataIndex:"classSize",key:"classSize",scopedSlots:{customRender:"classSize"}},{title:"节假日",dataIndex:"isHoliday",key:"isHoliday",scopedSlots:{customRender:"isHoliday"}},{title:"代课",dataIndex:"isSubstitute",key:"isSubstitute",scopedSlots:{customRender:"isSubstitute"}},{title:"手动调整",dataIndex:"adjustedFee",key:"adjustedFee",scopedSlots:{customRender:"adjustedFee"}},{title:"操作",key:"action",scopedSlots:{customRender:"action"}}],req:{teacherId:null,month:"",teacherLevel:"中级",campusId:null,monthlyTotalLessons:0,lessons:[]},idSeq:1}},mounted(){this.loadCampuses(),this.$watch(()=>this.req.campusId,l=>{this.onCampusChange(l)})},methods:{addLesson(){const l="l"+this.idSeq++;this.req.lessons.push({id:l,courseType:"班课",courseCategory:"常规英语",classSize:15,isHoliday:!1,isSubstitute:!1,adjustedFee:null})},removeLesson(l){this.req.lessons=(this.req.lessons||[]).filter(e=>e.id!==l)},reset(){this.req={teacherId:null,month:"",teacherLevel:"中级",campusId:null,monthlyTotalLessons:0,lessons:[]},this.result=null},fillDemo(){this.req.month="2025-11",this.req.lessons=[{id:"l1",courseType:"班课",courseCategory:"常规英语",classSize:22,isHoliday:!1,isSubstitute:!0,adjustedFee:null},{id:"l2",courseType:"一对一",courseCategory:"常规英语",classSize:1,isHoliday:!0,isSubstitute:!1,adjustedFee:null},{id:"l3",courseType:"班课",courseCategory:"雅思",classSize:18,isHoliday:!1,isSubstitute:!1,adjustedFee:200}],this.req.monthlyTotalLessons=86},async calculate(){if(!this.req.teacherId){this.$message&&this.$message.warning("请选择教师");return}if(!this.req.month){this.$message&&this.$message.warning("请选择月份");return}this.calculating=!0;try{const l=await fetch("/api/teacher/fee/calculate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(this.req)});if(!l.ok)throw new Error("服务异常");const e=await l.json();if(e&&e.code===200)this.result=e.data;else throw new Error(e&&e.msg||"试算失败")}catch(l){this.$message&&this.$message.error("试算失败："+(l.message||"网络或服务异常"))}finally{this.calculating=!1}},async loadCampuses(){this.campusLoading=!0;try{const e=await(await fetch("/api/base/campus/list")).json().catch(()=>({})),s=(Array.isArray(e&&e.data)?e.data:[]).filter(a=>String(a.status||"").toLowerCase()==="enabled");this.campusOptions=s.map(a=>({value:a.id,label:a.name||"#"+a.id}))}catch{this.campusOptions=[]}finally{this.campusLoading=!1}},async loadTeachers(){if(!this.req.campusId){this.teacherOptions=[];return}this.teacherLoading=!0;try{const e=await(await fetch(`/api/teacher/list?campusId=${this.req.campusId}&status=enabled&page=1&size=1000`)).json().catch(()=>({})),t=e&&e.data&&Array.isArray(e.data.items)?e.data.items:[];this.teacherOptions=t.map(s=>({value:s.id,label:`${s.name}${s.level?"（"+s.level+"）":""}`}))}catch{this.teacherOptions=[]}finally{this.teacherLoading=!1}},onCampusChange(l){this.req.teacherId=null,this.loadTeachers()}}};var c=function(){var e=this,t=e._self._c;return t("div",{staticClass:"fee-trial"},[t("a-page-header",{attrs:{title:"课时费试算","sub-title":"支持优先级与特殊规则"}}),t("a-card",{attrs:{bordered:""}},[t("a-form",{attrs:{"label-col":{span:6},"wrapper-col":{span:12}}},[t("a-form-item",{attrs:{label:"校区选择"}},[t("a-select",{staticStyle:{width:"100%"},attrs:{allowClear:!0,loading:e.campusLoading,placeholder:"先选择校区"},model:{value:e.req.campusId,callback:function(s){e.$set(e.req,"campusId",s)},expression:"req.campusId"}},e._l(e.campusOptions,function(s){return t("a-select-option",{key:s.value,attrs:{value:s.value}},[e._v(e._s(s.label))])}),1)],1),t("a-form-item",{attrs:{label:"教师"}},[t("a-select",{staticStyle:{width:"100%"},attrs:{disabled:!e.req.campusId,loading:e.teacherLoading,placeholder:"请选择教师"},model:{value:e.req.teacherId,callback:function(s){e.$set(e.req,"teacherId",s)},expression:"req.teacherId"}},e._l(e.teacherOptions,function(s){return t("a-select-option",{key:s.value,attrs:{value:s.value}},[e._v(e._s(s.label))])}),1)],1),t("a-form-item",{attrs:{label:"月份"}},[t("V2SimpleDate",{attrs:{type:"month",format:"YYYY-MM",placeholder:"选择月份"},model:{value:e.req.month,callback:function(s){e.$set(e.req,"month",s)},expression:"req.month"}})],1),t("a-form-item",{attrs:{label:"教师等级"}},[t("a-select",{attrs:{placeholder:"选择等级"},model:{value:e.req.teacherLevel,callback:function(s){e.$set(e.req,"teacherLevel",s)},expression:"req.teacherLevel"}},[t("a-select-option",{attrs:{value:"初级"}},[e._v("初级")]),t("a-select-option",{attrs:{value:"中级"}},[e._v("中级")]),t("a-select-option",{attrs:{value:"高级"}},[e._v("高级")])],1)],1),t("a-form-item",{attrs:{label:"月总课时"}},[t("a-input-number",{staticStyle:{width:"100%"},attrs:{min:0},model:{value:e.req.monthlyTotalLessons,callback:function(s){e.$set(e.req,"monthlyTotalLessons",s)},expression:"req.monthlyTotalLessons"}})],1)],1),t("a-divider",[e._v("课时列表")]),t("a-space",{staticStyle:{"margin-bottom":"8px"}},[t("a-button",{attrs:{type:"dashed"},on:{click:e.addLesson}},[e._v("新增课时")]),t("a-button",{on:{click:e.fillDemo}},[e._v("填充示例")])],1),t("a-table",{attrs:{"data-source":e.req.lessons,columns:e.columns,rowKey:"id",pagination:!1},scopedSlots:e._u([{key:"courseType",fn:function(s,a){return t("span",{},[t("a-select",{staticStyle:{width:"120px"},model:{value:a.courseType,callback:function(i){e.$set(a,"courseType",i)},expression:"record.courseType"}},[t("a-select-option",{attrs:{value:"班课"}},[e._v("班课")]),t("a-select-option",{attrs:{value:"一对一"}},[e._v("一对一")])],1)],1)}},{key:"courseCategory",fn:function(s,a){return t("span",{},[t("a-select",{staticStyle:{width:"140px"},model:{value:a.courseCategory,callback:function(i){e.$set(a,"courseCategory",i)},expression:"record.courseCategory"}},[t("a-select-option",{attrs:{value:"常规英语"}},[e._v("常规英语")]),t("a-select-option",{attrs:{value:"雅思"}},[e._v("雅思")])],1)],1)}},{key:"classSize",fn:function(s,a){return t("span",{},[t("a-input-number",{staticStyle:{width:"100px"},attrs:{min:0},model:{value:a.classSize,callback:function(i){e.$set(a,"classSize",i)},expression:"record.classSize"}})],1)}},{key:"isHoliday",fn:function(s,a){return t("span",{},[t("a-switch",{model:{value:a.isHoliday,callback:function(i){e.$set(a,"isHoliday",i)},expression:"record.isHoliday"}})],1)}},{key:"isSubstitute",fn:function(s,a){return t("span",{},[t("a-switch",{model:{value:a.isSubstitute,callback:function(i){e.$set(a,"isSubstitute",i)},expression:"record.isSubstitute"}})],1)}},{key:"adjustedFee",fn:function(s,a){return t("span",{},[t("a-input-number",{staticStyle:{width:"120px"},attrs:{min:0,placeholder:"手动调整优先"},model:{value:a.adjustedFee,callback:function(i){e.$set(a,"adjustedFee",i)},expression:"record.adjustedFee"}})],1)}},{key:"action",fn:function(s,a){return t("span",{},[t("a-button",{attrs:{type:"link"},on:{click:function(i){return e.removeLesson(a.id)}}},[e._v("删除")])],1)}}])}),t("div",{staticStyle:{"margin-top":"12px"}},[t("a-space",[t("a-button",{attrs:{type:"primary",loading:e.calculating},on:{click:e.calculate}},[e._v("试算")]),t("a-button",{on:{click:e.reset}},[e._v("重置")])],1)],1)],1),e.result?t("a-card",{staticStyle:{"margin-top":"12px"},attrs:{bordered:""}},[t("template",{slot:"title"},[e._v("试算结果")]),t("a-descriptions",{attrs:{bordered:"",column:2}},[t("a-descriptions-item",{attrs:{label:"教师ID"}},[e._v(e._s(e.result.teacherId))]),t("a-descriptions-item",{attrs:{label:"月份"}},[e._v(e._s(e.result.month))]),t("a-descriptions-item",{attrs:{label:"课时数"}},[e._v(e._s(e.result.totalLessons))]),t("a-descriptions-item",{attrs:{label:"基础金额"}},[e._v(e._s(e.result.baseAmount))]),t("a-descriptions-item",{attrs:{label:"节假日额外"}},[e._v(e._s(e.result.holidayExtra))]),t("a-descriptions-item",{attrs:{label:"代课加价"}},[e._v(e._s(e.result.substituteExtra))]),t("a-descriptions-item",{attrs:{label:"阶梯奖励"}},[e._v(e._s(e.result.tierBonus))]),t("a-descriptions-item",{attrs:{label:"最终金额"}},[e._v(e._s(e.result.finalAmount))])],1)],2):e._e()],1)},u=[],d=o(n,c,u,!1,null,"5acaaee9",null,null);const m=d.exports;export{m as default};
