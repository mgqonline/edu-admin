import{n as r}from"./index-67337038.js";const i={name:"TextbookManage",data(){return{form:{name:"",publisher:"",unitPrice:0},keyword:"",data:[],recordVisible:!1,records:[]}},computed:{columns(){return[{title:"名称",dataIndex:"name"},{title:"出版社",dataIndex:"publisher"},{title:"单价",dataIndex:"unitPrice"},{title:"库存",dataIndex:"stock"},{title:"操作",key:"actions",scopedSlots:{customRender:"actions"}}]},recordColumns(){return[{title:"类型",dataIndex:"type"},{title:"数量",dataIndex:"qty"},{title:"时间",dataIndex:"time"}]}},created(){this.loadTextbooks()},methods:{async saveTextbook(){const t=await(await fetch("/api/course/textbook/save",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(this.form)})).json();t&&t.code===200?(this.$message.success("保存成功"),this.loadTextbooks()):this.$message.error("保存失败")},resetForm(){this.form={name:"",publisher:"",unitPrice:0}},async loadTextbooks(){const a="/api/course/textbook/list"+(this.keyword?"?keyword="+encodeURIComponent(this.keyword):""),e=await(await fetch(a)).json();this.data=e&&e.code===200?e.data||[]:[]},async inventory(a,t){const e=await this.promptQty(t);if(!e)return;const o=t==="in"?`/api/course/textbook/inventory/in?textbookId=${a.textbookId}&qty=${e}`:`/api/course/textbook/inventory/out?textbookId=${a.textbookId}&qty=${e}`,n=await(await fetch(o,{method:"POST"})).json();n&&n.code===200&&(this.$message.success((t==="in"?"入库":"出库")+"成功"),this.loadTextbooks())},promptQty(a){return new Promise(t=>{const e=window.prompt("请输入数量","1"),o=Number(e);t(Number.isFinite(o)&&o>0?Math.floor(o):0)})},async viewRecords(a){const e=await(await fetch(`/api/course/textbook/inventory/records/${a.textbookId}`)).json(),o=e&&e.code===200?e.data||[]:[];this.records=o.map((s,n)=>Object.assign({rkey:`${a.textbookId}-${n}`},s)),this.recordVisible=!0},async loadLowStock(){const t=await(await fetch("/api/course/textbook/low-stock?threshold=5")).json(),e=t&&t.code===200?t.data||[]:[];if(!e.length)this.$message.info("暂无低库存教材");else{const o=e.map(s=>`${s.name}(库存:${s.stock})`).join("，");this.$message.warn("低库存："+o)}}}};var c=function(){var t=this,e=t._self._c;return e("div",{staticStyle:{background:"#fff",padding:"16px"}},[e("h3",[t._v("教材与教具管理")]),e("a-form",{staticStyle:{"margin-bottom":"12px"},attrs:{layout:"inline"}},[e("a-form-item",{attrs:{label:"名称"}},[e("a-input",{staticStyle:{width:"200px"},attrs:{placeholder:"教材名称"},model:{value:t.form.name,callback:function(o){t.$set(t.form,"name",o)},expression:"form.name"}})],1),e("a-form-item",{attrs:{label:"出版社"}},[e("a-input",{staticStyle:{width:"200px"},attrs:{placeholder:"出版社"},model:{value:t.form.publisher,callback:function(o){t.$set(t.form,"publisher",o)},expression:"form.publisher"}})],1),e("a-form-item",{attrs:{label:"单价"}},[e("a-input-number",{staticStyle:{width:"160px"},attrs:{min:0,step:1},model:{value:t.form.unitPrice,callback:function(o){t.$set(t.form,"unitPrice",o)},expression:"form.unitPrice"}})],1),e("a-button",{attrs:{type:"primary"},on:{click:t.saveTextbook}},[t._v("保存")]),e("a-button",{staticStyle:{"margin-left":"8px"},on:{click:t.resetForm}},[t._v("重置")])],1),e("a-space",{staticStyle:{"margin-bottom":"8px"}},[e("a-input-search",{staticStyle:{width:"300px"},attrs:{placeholder:"搜索教材或出版社"},on:{search:t.loadTextbooks},model:{value:t.keyword,callback:function(o){t.keyword=o},expression:"keyword"}}),e("a-button",{on:{click:t.loadTextbooks}},[t._v("刷新")]),e("a-button",{attrs:{type:"dashed"},on:{click:t.loadLowStock}},[t._v("低库存预警")])],1),e("a-table",{attrs:{columns:t.columns,"data-source":t.data,rowKey:"textbookId",pagination:!1},scopedSlots:t._u([{key:"actions",fn:function(o,s){return e("span",{},[e("a-space",[e("a",{on:{click:function(n){return t.inventory(s,"in")}}},[t._v("入库")]),e("a",{on:{click:function(n){return t.inventory(s,"out")}}},[t._v("出库")]),e("a",{on:{click:function(n){return t.viewRecords(s)}}},[t._v("记录")])])],1)}}])}),e("a-modal",{attrs:{visible:t.recordVisible,title:"库存记录",footer:"null"},on:{cancel:function(o){t.recordVisible=!1}}},[e("a-table",{attrs:{columns:t.recordColumns,"data-source":t.records,rowKey:"rkey",pagination:!1}})],1)],1)},l=[],d=r(i,c,l,!1,null,"a088837a",null,null);const m=d.exports;export{m as default};
