import{n as m}from"./index-67337038.js";const g={name:"LoginPage",data(){return{form:{username:"",password:""},submitting:!1,remember:!0,forgotVisible:!1,forgot:{username:"",oldPassword:"",newPassword:"",code:""},forgotMode:"reset",changing:!1,sendingCode:!1,lastCode:"",icpRecord:"ICP备案号：ICP10000891",companyName:"开发公司：示例科技有限公司",meteors:[],starField:[],starRAF:0}},mounted(){this.initMeteors(),this.initStars(),window.addEventListener("resize",this.resizeStars)},beforeDestroy(){this.starRAF&&cancelAnimationFrame(this.starRAF),window.removeEventListener("resize",this.resizeStars)},created(){try{const a=localStorage.getItem("__REMEMBER__")==="1";this.remember=a!==!1;const e=localStorage.getItem("__REMEMBER_USER__")||"",s=localStorage.getItem("__REMEMBER_PSW__")||"";let t="";if(s)try{t=atob(s)}catch{t=""}a&&e&&t&&(this.form.username=e,this.form.password=t)}catch{}},methods:{initMeteors(){const a=[];for(let s=0;s<12;s++){const t=Math.round(Math.random()*90+2),i=(Math.random()*8).toFixed(2)+"s",n=(3+Math.random()*4).toFixed(2)+"s",o=(.6+Math.random()*.4).toFixed(2);a.push({id:"m"+s,style:{top:t+"vh",left:"-20vw",opacity:o,animation:"shoot "+n+" linear "+i+" infinite"}})}this.meteors=a},initStars(){const a=this.$refs.bgCanvas;if(!a)return;const e=window.devicePixelRatio||1;a.width=Math.floor(window.innerWidth*e),a.height=Math.floor(window.innerHeight*e);const s=a.getContext("2d");s.scale(e,e);const t=[],i=Math.floor(window.innerWidth*window.innerHeight/8e3);for(let o=0;o<i;o++){const r=Math.random()*window.innerWidth,l=Math.random()*window.innerHeight,c=Math.random()*1.5+.2,d=Math.random()*1;t.push({x:r,y:l,r:c,t:d})}this.starField=t;const n=()=>{s.clearRect(0,0,window.innerWidth,window.innerHeight);for(let o=0;o<this.starField.length;o++){const r=this.starField[o];r.t+=.02;const l=.6+Math.sin(r.t)*.4;s.globalAlpha=l,s.fillStyle="#ffffff",s.beginPath(),s.arc(r.x,r.y,r.r,0,Math.PI*2),s.fill()}s.globalAlpha=1,this.starRAF=requestAnimationFrame(n)};n()},resizeStars(){this.$refs.bgCanvas&&this.initStars()},openForgot(){this.forgotVisible=!0,this.forgot.username=this.form.username||""},async sendCode(){if(!this.forgot.username)return this.$message&&this.$message.warning("请填写用户名");this.sendingCode=!0;try{const e=await(await fetch("/api/auth/password/reset/request",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:this.forgot.username})})).json();if(e&&e.code===200){const s=e.data||{};this.lastCode=s.code||"",this.$message&&this.$message.success("验证码已发送（演示环境直接显示）")}else this.$message&&this.$message.error(e.message||"发送失败")}catch{this.$message&&this.$message.error("发送失败")}this.sendingCode=!1},async onSubmitForgot(){if(this.forgotMode==="reset"){if(!this.forgot.username||!this.forgot.code||!this.forgot.newPassword)return this.$message&&this.$message.warning("请填写用户名、验证码与新密码");this.changing=!0;try{const e=await(await fetch("/api/auth/password/reset/confirm",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:this.forgot.username,code:this.forgot.code,newPassword:this.forgot.newPassword})})).json();e&&e.code===200?(this.$message&&this.$message.success("密码已重置，请使用新密码登录"),this.forgotVisible=!1,this.form.username=this.forgot.username):this.$message&&this.$message.error(e.message||"重置失败")}catch{this.$message&&this.$message.error("重置失败")}this.changing=!1}else{if(!this.forgot.username||!this.forgot.oldPassword||!this.forgot.newPassword)return this.$message&&this.$message.warning("请填写用户名、旧密码与新密码");this.changing=!0;try{const e=await(await fetch("/api/auth/password/change",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:this.forgot.username,oldPassword:this.forgot.oldPassword,newPassword:this.forgot.newPassword})})).json();e&&e.code===200?(this.$message&&this.$message.success("密码已更新，请使用新密码登录"),this.forgotVisible=!1,this.form.username=this.forgot.username):this.$message&&this.$message.error(e.message||"修改失败")}catch{this.$message&&this.$message.error("网络错误，修改失败")}this.changing=!1}},async onLogin(){if(!this.form.username||!this.form.password)return this.$message&&this.$message.warning("请输入用户名和密码");this.submitting=!0;try{const e=await(await fetch("/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(this.form)})).json();if(e&&e.code===200){const s=e.data||{};localStorage.setItem("AUTH_TOKEN",s.token||""),s.user&&localStorage.setItem("__USER__",JSON.stringify(s.user));const t=s.perms||[];if(window.__PERMS__=t,localStorage.setItem("__PERMS__",JSON.stringify(t)),this.remember&&localStorage.setItem("__REMEMBER__","1"),this.remember)try{localStorage.setItem("__REMEMBER_USER__",String(this.form.username||"")),localStorage.setItem("__REMEMBER_PSW__",btoa(String(this.form.password||"")))}catch{}this.$message&&this.$message.success("登录成功"),this.$router.replace("/attendance")}else this.$message&&this.$message.error(e.message||"登录失败")}catch{this.$message&&this.$message.error("登录失败")}finally{this.submitting=!1}}}};var h=function(){var e=this,s=e._self._c;return s("div",{staticClass:"login-page"},[s("div",{staticClass:"bg-decor"},[s("canvas",{ref:"bgCanvas",staticClass:"bg-stars"}),s("div",{staticClass:"meteors"},e._l(e.meteors,function(t){return s("div",{key:t.id,staticClass:"meteor",style:t.style})}),0)]),s("div",{staticClass:"login-shell"},[e._m(0),s("div",{staticClass:"form-pane"},[s("a-card",{staticClass:"login-card",attrs:{bordered:!1}},[s("div",{staticClass:"brand"},[s("div",{staticClass:"brand-logo"},[e._v("EA")]),s("div",{staticClass:"brand-title"},[e._v("Edu Admin")]),s("div",{staticClass:"brand-subtitle"},[e._v("教务管理后台")])]),s("a-form",{attrs:{layout:"vertical"}},[s("a-form-item",{attrs:{label:"用户名"}},[s("a-input",{attrs:{placeholder:"请输入用户名"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.onLogin.apply(null,arguments)}},model:{value:e.form.username,callback:function(t){e.$set(e.form,"username",t)},expression:"form.username"}})],1),s("a-form-item",{attrs:{label:"密码"}},[s("a-input-password",{attrs:{placeholder:"请输入密码"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.onLogin.apply(null,arguments)}},model:{value:e.form.password,callback:function(t){e.$set(e.form,"password",t)},expression:"form.password"}})],1),s("div",{staticClass:"form-extras"},[s("a-checkbox",{model:{value:e.remember,callback:function(t){e.remember=t},expression:"remember"}},[e._v("记住我")]),s("a",{staticClass:"link",attrs:{href:"javascript:void(0)"},on:{click:e.openForgot}},[e._v("忘记密码")])],1),s("a-button",{attrs:{type:"primary",block:"",loading:e.submitting},on:{click:e.onLogin}},[e._v("登录")])],1)],1)],1)]),s("a-modal",{attrs:{title:"忘记密码 / 修改密码","confirm-loading":e.changing},on:{ok:e.onSubmitForgot,cancel:()=>{e.forgotVisible=!1}},model:{value:e.forgotVisible,callback:function(t){e.forgotVisible=t},expression:"forgotVisible"}},[s("a-form",{attrs:{layout:"vertical"}},[s("a-radio-group",{staticStyle:{"margin-bottom":"12px"},model:{value:e.forgotMode,callback:function(t){e.forgotMode=t},expression:"forgotMode"}},[s("a-radio",{attrs:{value:"reset"}},[e._v("找回密码（验证码）")]),s("a-radio",{attrs:{value:"change"}},[e._v("修改密码（知道旧密码）")])],1),s("a-form-item",{attrs:{label:"用户名"}},[s("a-input",{attrs:{placeholder:"请输入用户名"},model:{value:e.forgot.username,callback:function(t){e.$set(e.forgot,"username",t)},expression:"forgot.username"}})],1),e.forgotMode==="reset"?[s("a-form-item",{attrs:{label:"验证码"}},[s("a-input",{attrs:{placeholder:"请输入验证码"},model:{value:e.forgot.code,callback:function(t){e.$set(e.forgot,"code",t)},expression:"forgot.code"}})],1),s("a-button",{staticStyle:{"margin-bottom":"8px"},attrs:{size:"small",disabled:e.sendingCode},on:{click:e.sendCode}},[e._v(e._s(e.sendingCode?"发送中...":"发送验证码"))]),e.lastCode?s("div",{staticStyle:{"margin-top":"4px",color:"#888"}},[e._v("演示环境验证码："+e._s(e.lastCode)+"（10分钟内有效）")]):e._e()]:[s("a-form-item",{attrs:{label:"旧密码"}},[s("a-input-password",{attrs:{placeholder:"请输入旧密码"},model:{value:e.forgot.oldPassword,callback:function(t){e.$set(e.forgot,"oldPassword",t)},expression:"forgot.oldPassword"}})],1)],s("a-form-item",{attrs:{label:"新密码"}},[s("a-input-password",{attrs:{placeholder:"请输入新密码"},model:{value:e.forgot.newPassword,callback:function(t){e.$set(e.forgot,"newPassword",t)},expression:"forgot.newPassword"}})],1),s("div",{staticStyle:{"margin-top":"8px",color:"#888"}},[e._v(" 无法找回旧密码？可使用“找回密码（验证码）”方式；生产环境验证码将通过短信/邮件发送。 ")])],2)],1),s("div",{staticClass:"footer-info"},[s("span",[e._v(e._s(e.icpRecord))]),s("span",{staticClass:"dot"},[e._v("·")]),s("span",[e._v(e._s(e.companyName))])])],1)},f=[function(){var a=this,e=a._self._c;return e("div",{staticClass:"hero-pane"},[e("div",{staticClass:"hero-badge"},[a._v("EA")]),e("div",{staticClass:"hero-title"},[a._v("Edu Admin 教务系统")]),e("div",{staticClass:"hero-subtitle"},[a._v("高效、稳定的教务管理平台")]),e("div",{staticClass:"hero-features"},[e("div",{staticClass:"feat"},[a._v("一体化教务流程")]),e("div",{staticClass:"feat"},[a._v("数据可视化与统计")]),e("div",{staticClass:"feat"},[a._v("安全权限与审计")])])])}],u=m(g,h,f,!1,null,null,null,null);const p=u.exports;export{p as default};
