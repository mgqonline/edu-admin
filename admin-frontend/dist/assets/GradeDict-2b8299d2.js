import{n as l}from"./index-67337038.js";const r={name:"GradeDictPage",data(){return{loading:!1,list:[],campusOptions:[],filters:{status:"",campusId:null,q:""},modal:{visible:!1,mode:"add",form:{id:null,campusId:null,name:"",status:"enabled",sortOrder:0}},pagination:{current:1,pageSize:10,total:0,showSizeChanger:!0,pageSizeOptions:["10","20","50","100"]},columns:[{title:"学校/校区",dataIndex:"campusId",key:"campusId",scopedSlots:{customRender:"campus"}},{title:"名称",dataIndex:"name",key:"name"},{title:"状态",dataIndex:"status",key:"status",scopedSlots:{customRender:"status"}},{title:"排序",dataIndex:"sortOrder",key:"sortOrder"},{title:"操作",key:"action",scopedSlots:{customRender:"action"}}]}},computed:{modalTitle(){return this.modal.mode==="edit"?"编辑年级":"新增年级"}},created(){this.loadCampusOptions().then(()=>this.loadData())},methods:{campusNameById(s){const t=this.campusOptions.find(a=>String((a&&a.id)!=null?a.id:a.campusId)===String(s));return t?t.name:""},async loadCampusOptions(){try{const t=await(await fetch("/api/base/campus/list")).json();let a=t&&t.code===200?t.data||[]:[];if(!a||!a.length){const i=await(await fetch("/api/campus/list")).json();i&&i.code===200&&(a=(i.data||[]).map(o=>({id:o.id!=null?o.id:o.campusId,name:o.name})))}this.campusOptions=a}catch{this.campusOptions=[]}},async loadData(){this.loading=!0;try{const s=new URLSearchParams;this.filters.campusId&&s.append("campusId",this.filters.campusId),this.filters.status&&s.append("status",this.filters.status),this.filters.q&&s.append("q",this.filters.q),s.append("page",String(this.pagination.current||1)),s.append("size",String(this.pagination.pageSize||10));const a=await(await fetch(`/api/dict/grade/list${"?"+s.toString()}`)).json();if(a&&a.code===200){const e=a.data||{},i=Array.isArray(e.items)?e.items:Array.isArray(a.data)?a.data:[];this.list=i,this.pagination={...this.pagination,total:Number(e.total||i.length)}}else this.list=[]}catch{this.list=[]}this.loading=!1},onTableChange(s){this.pagination.current=s.current,this.pagination.pageSize=s.pageSize,this.loadData()},openAdd(){this.modal.mode="add",this.modal.form={id:null,campusId:this.filters.campusId||this.campusOptions[0]&&this.campusOptions[0].id||null,name:"",status:"enabled",sortOrder:0},this.modal.visible=!0},openEdit(s){this.modal.mode="edit",this.modal.form={id:s.id,campusId:s.campusId,name:s.name,status:s.status||"enabled",sortOrder:Number(s.sortOrder||0)},this.modal.visible=!0},closeModal(){this.modal.visible=!1},async saveModal(){const s=this.modal.form;if(!s.campusId||!s.name){this.$message&&this.$message.warning("请填写学校与名称");return}try{const t=Number(s.campusId);if(!Number.isFinite(t)){this.$message&&this.$message.error("无效的学校/校区ID");return}if(this.modal.mode==="add"){const e=await(await fetch("/api/dict/grade/save",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({campusId:t,name:String(s.name).trim(),status:s.status,sortOrder:Number(s.sortOrder||0)})})).json();if(e&&e.code===200)this.$message&&this.$message.success("新增成功"),this.modal.visible=!1,this.loadData();else throw new Error(e&&e.msg?e.msg:"新增失败")}else{const e=await(await fetch(`/api/dict/grade/update/${s.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({campusId:t,name:String(s.name).trim(),status:s.status,sortOrder:Number(s.sortOrder||0)})})).json();if(e&&e.code===200)this.$message&&this.$message.success("更新成功"),this.modal.visible=!1,this.loadData();else throw new Error(e&&e.msg?e.msg:"更新失败")}}catch(t){this.$message&&this.$message.error(t.message||"操作失败"),console.warn("Grade save error:",t)}},async deleteItem(s){try{const a=await(await fetch(`/api/dict/grade/delete/${s.id}`,{method:"DELETE"})).json();if(a&&a.code===200)this.$message&&this.$message.success("删除成功"),this.loadData();else throw new Error("删除失败")}catch{this.$message&&this.$message.error("删除失败")}},async toggleStatus(s){if(!(!s||!s.name))try{const t=s.status==="enabled"?"disabled":"enabled",e=await(await fetch(`/api/dict/grade/update/${s.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({campusId:s.campusId,name:s.name,status:t,sortOrder:Number(s.sortOrder||0)})})).json();if(e&&e.code===200)this.$message&&this.$message.success("状态已更新"),this.loadData();else throw new Error("更新失败")}catch{this.$message&&this.$message.error("更新失败")}},async updateSort(s){if(!(!s||!s.name))try{const a=await(await fetch(`/api/dict/grade/update/${s.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({campusId:s.campusId,name:s.name,status:s.status||"enabled",sortOrder:Number(s.sortOrder||0)})})).json();if(a&&a.code===200)this.$message&&this.$message.success("排序已更新"),this.loadData();else throw new Error("更新失败")}catch{this.$message&&this.$message.error("更新失败")}}}};var d=function(){var t=this,a=t._self._c;return a("div",{staticClass:"grade-dict-page"},[a("a-page-header",{attrs:{title:"年级维护","sub-title":"维护年级字典（名称、状态、排序）"}}),a("a-card",{attrs:{bordered:""}},[a("a-space",{staticStyle:{"margin-bottom":"12px"},attrs:{wrap:""}},[a("a-button",{attrs:{type:"primary"},on:{click:t.openAdd}},[t._v("新增年级")]),a("a-input-search",{staticStyle:{width:"220px"},attrs:{placeholder:"按名称关键词搜索",allowClear:""},on:{search:t.loadData},model:{value:t.filters.q,callback:function(e){t.$set(t.filters,"q",e)},expression:"filters.q"}}),a("a-select",{staticStyle:{width:"200px"},attrs:{placeholder:"学校筛选",allowClear:""},on:{change:t.loadData},model:{value:t.filters.campusId,callback:function(e){t.$set(t.filters,"campusId",e)},expression:"filters.campusId"}},t._l(t.campusOptions,function(e){return a("a-select-option",{key:e.id,attrs:{value:e.id}},[t._v(t._s(e.name))])}),1),a("a-select",{staticStyle:{width:"160px"},attrs:{placeholder:"状态筛选",allowClear:""},on:{change:t.loadData},model:{value:t.filters.status,callback:function(e){t.$set(t.filters,"status",e)},expression:"filters.status"}},[a("a-select-option",{attrs:{value:"enabled"}},[t._v("启用")]),a("a-select-option",{attrs:{value:"disabled"}},[t._v("禁用")])],1),a("a-button",{attrs:{loading:t.loading},on:{click:t.loadData}},[t._v("刷新")])],1),a("a-table",{attrs:{"data-source":t.list,columns:t.columns,rowKey:"id",pagination:t.pagination},on:{change:t.onTableChange},scopedSlots:t._u([{key:"campus",fn:function(e,i){return[t._v(" "+t._s(i&&i.campusName||t.campusNameById(e||i&&i.campusId)||"-")+" ")]}},{key:"status",fn:function(e){return[a("a-tag",{attrs:{color:e==="enabled"?"green":"red"}},[t._v(t._s(e==="enabled"?"启用":"禁用"))])]}},{key:"action",fn:function(e,i){return[a("a-space",[a("a-button",{attrs:{size:"small",disabled:!i||i.id==null},on:{click:function(n){i&&t.openEdit(i)}}},[t._v("编辑")]),i&&i.id!=null?a("a-popconfirm",{attrs:{title:"确认删除该年级？"},on:{confirm:function(n){return t.deleteItem(i)}}},[a("a-button",{attrs:{size:"small",type:"danger"}},[t._v("删除")])],1):t._e(),a("a-button",{attrs:{size:"small",disabled:!i||i.id==null},on:{click:function(n){i&&t.toggleStatus(i)}}},[t._v(" "+t._s((i&&i.status)==="enabled"?"禁用":"启用")+" ")]),i&&i.id!=null?a("a-popconfirm",{attrs:{title:"更新排序？"},on:{confirm:function(n){return t.updateSort(i)}}},[a("a-button",{attrs:{size:"small"}},[t._v("更新排序")])],1):t._e()],1)]}}])})],1),a("a-modal",{attrs:{visible:t.modal.visible,title:t.modalTitle},on:{ok:t.saveModal,cancel:t.closeModal}},[a("a-form",{attrs:{"label-col":{span:6},"wrapper-col":{span:16}}},[a("a-form-item",{attrs:{label:"学校/校区"}},[a("a-select",{attrs:{placeholder:"选择学校/校区"},model:{value:t.modal.form.campusId,callback:function(e){t.$set(t.modal.form,"campusId",e)},expression:"modal.form.campusId"}},t._l(t.campusOptions,function(e){return a("a-select-option",{key:e.id,attrs:{value:e.id}},[t._v(t._s(e.name))])}),1)],1),a("a-form-item",{attrs:{label:"名称"}},[a("a-input",{attrs:{placeholder:"请输入年级名称"},model:{value:t.modal.form.name,callback:function(e){t.$set(t.modal.form,"name",e)},expression:"modal.form.name"}})],1),a("a-form-item",{attrs:{label:"状态"}},[a("a-select",{model:{value:t.modal.form.status,callback:function(e){t.$set(t.modal.form,"status",e)},expression:"modal.form.status"}},[a("a-select-option",{attrs:{value:"enabled"}},[t._v("启用")]),a("a-select-option",{attrs:{value:"disabled"}},[t._v("禁用")])],1)],1),a("a-form-item",{attrs:{label:"排序"}},[a("a-input-number",{staticStyle:{width:"100%"},attrs:{min:0,max:999},model:{value:t.modal.form.sortOrder,callback:function(e){t.$set(t.modal.form,"sortOrder",e)},expression:"modal.form.sortOrder"}})],1)],1)],1)],1)},m=[],c=l(r,d,m,!1,null,null,null,null);const p=c.exports;export{p as default};
