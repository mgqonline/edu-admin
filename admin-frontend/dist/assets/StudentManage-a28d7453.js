import{n as d}from"./index-67337038.js";const i={name:"StudentManage",data(){return{list:[],settlementIds:new Set,columns:[{title:"姓名",dataIndex:"name",key:"name"},{title:"性别",dataIndex:"gender",key:"gender",scopedSlots:{customRender:"gender"}},{title:"校区",dataIndex:"campusName",key:"campusName"},{title:"学生类型",dataIndex:"studentType",key:"studentType",scopedSlots:{customRender:"studentType"}},{title:"操作",key:"action",scopedSlots:{customRender:"action"}}]}},methods:{formatGender(e){return{male:"男",female:"女"}[e]||e||"-"},async loadStudents(){try{const t=await(await fetch("/api/student/list")).json(),n=Array.isArray(t.data)?t.data:[];this.list=n.map(a=>({...a,studentType:null}))}catch{this.list=[]}},async loadSettlements(){try{const t=await(await fetch("/api/finance/settlement/list")).json(),n=Array.isArray(t.data)?t.data:[],a=new Set(n.map(s=>s.studentId).filter(s=>s!=null));this.settlementIds=a}catch{this.settlementIds=new Set}},computeStudentType(){this.list=(this.list||[]).map(e=>{const t=e.id!=null?e.id:e.studentId,n=this.settlementIds.has(t)?"老生":"新生";return{...e,studentType:n,_studentType:n}})},openEnrollData(e){const t=e.id||e.studentId;this.$router&&this.$router.push({path:"/student/enroll",query:{studentId:t}})},openChange(e){const t=e.id||e.studentId;this.$router&&this.$router.push({path:"/student/change",query:{studentId:t}})},openEnrollPay(e){const t=e.id||e.studentId;this.$router&&this.$router.push({path:"/finance/settlement/fee",query:{studentId:t}})},openRenew(e){const t=e.id||e.studentId;this.$router&&this.$router.push({path:"/finance/settlement/renew",query:{studentId:t}})},openRefund(e){const t=e.id||e.studentId;this.$router&&this.$router.push({path:"/finance/settlement/refund",query:{studentId:t}})},openPayRecords(e){const t=e.id||e.studentId;this.$router&&this.$router.push({path:"/finance/settlement/renew",query:{studentId:t}})}},created(){this.loadStudents().then(()=>this.loadSettlements()).then(()=>this.computeStudentType())}};var o=function(){var t=this,n=t._self._c;return n("div",{staticClass:"student-manage"},[n("a-page-header",{attrs:{title:"学员管理","sub-title":"查看与联动报班/续费/退费/记录"}}),n("a-card",{attrs:{bordered:"",title:"学员列表"}},[n("a-table",{attrs:{"data-source":t.list,columns:t.columns,rowKey:"id",pagination:!1},scopedSlots:t._u([{key:"gender",fn:function(a,s){return n("span",{},[t._v(" "+t._s(t.formatGender(a))+" ")])}},{key:"studentType",fn:function(a,s){return n("span",{},[a==="老生"?n("a-tag",{attrs:{color:"geekblue"}},[t._v("老生")]):n("a-tag",{attrs:{color:"blue"}},[t._v("新生")])],1)}},{key:"action",fn:function(a,s){return n("span",{},[n("a-space",[n("a-button",{attrs:{size:"small",disabled:!s},on:{click:function(u){return t.openEnrollData(s)}}},[t._v("报班数据")]),n("a-button",{attrs:{size:"small",disabled:!s},on:{click:function(u){return t.openChange(s)}}},[t._v("调班")]),s&&s._studentType==="新生"?n("a-button",{attrs:{size:"small",type:"default"},on:{click:function(u){return t.openEnrollPay(s)}}},[t._v("缴费")]):n("a-button",{attrs:{size:"small",type:"primary",disabled:!s},on:{click:function(u){return t.openRenew(s)}}},[t._v("续费")]),s&&s._studentType==="老生"?n("a-button",{attrs:{size:"small"},on:{click:function(u){return t.openRefund(s)}}},[t._v("退费")]):t._e(),s&&s._studentType==="老生"?n("a-button",{attrs:{size:"small"},on:{click:function(u){return t.openPayRecords(s)}}},[t._v("缴费记录")]):t._e()],1)],1)}}])})],1)],1)},r=[],l=d(i,o,r,!1,null,"e70c592c",null,null);const p=l.exports;export{p as default};
