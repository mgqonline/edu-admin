import{n as r}from"./index-67337038.js";const i={name:"CourseManage",data(){return{form:{name:"",category:"",type:"班课",ageRange:"",lessonCount:32,unitPrice:0,outline:"",objective:"",status:"draft",courseId:""},keyword:"",courses:[],textbooks:[],bindVisible:!1,selectedCourseId:"",selectedMaterials:[]}},computed:{courseColumns(){return[{title:"课程名称",dataIndex:"name"},{title:"类别",dataIndex:"category"},{title:"类型",dataIndex:"type"},{title:"课时数",dataIndex:"lessonCount"},{title:"单价",dataIndex:"unitPrice"},{title:"状态",dataIndex:"status",scopedSlots:{customRender:"status"}},{title:"操作",key:"actions",scopedSlots:{customRender:"actions"}}]}},created(){this.loadCourses(),this.loadTextbooks()},methods:{statusText(s){return s==="draft"?"草稿":s==="published"?"已发布":s==="offline"?"已下架":s},async saveCourse(){const e=await(await fetch("/api/course/save",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(this.form)})).json();e&&e.code===200?(this.$message.success("保存成功"),this.form.courseId=e.data.courseId,this.loadCourses()):this.$message.error("保存失败")},resetForm(){this.form={name:"",category:"",type:"班课",ageRange:"",lessonCount:32,unitPrice:0,outline:"",objective:"",status:"draft",courseId:""}},async loadCourses(){const s="/api/course/list"+(this.keyword?"?keyword="+encodeURIComponent(this.keyword):""),t=await(await fetch(s)).json();this.courses=t&&t.code===200?t.data||[]:[]},editCourse(s){this.form=Object.assign({},s)},async changeStatus(s,e){const a=await(await fetch(`/api/course/status/${s.courseId}?status=${e}`,{method:"POST"})).json();a&&a.code===200&&(this.$message.success("状态已更新"),this.loadCourses())},async loadTextbooks(){const e=await(await fetch("/api/course/textbook/list")).json();this.textbooks=e&&e.code===200?e.data||[]:[]},openBindMaterials(s){this.selectedCourseId=s.courseId,this.selectedMaterials=Array.isArray(s.materials)?s.materials.slice():[],this.bindVisible=!0},async doBindMaterials(){const s={courseId:this.selectedCourseId,materialIds:this.selectedMaterials},t=await(await fetch("/api/course/materials/bind",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)})).json();t&&t.code===200?(this.$message.success("教材绑定成功"),this.bindVisible=!1,this.loadCourses()):this.$message.error("绑定失败")}}};var l=function(){var e=this,t=e._self._c;return t("div",{staticStyle:{background:"#fff",padding:"16px"}},[t("h3",[e._v("课程管理")]),t("a-form",{attrs:{layout:"vertical"}},[t("a-row",{attrs:{gutter:16}},[t("a-col",{attrs:{span:8}},[t("a-form-item",{attrs:{label:"课程名称"}},[t("a-input",{attrs:{placeholder:"请输入课程名称"},model:{value:e.form.name,callback:function(a){e.$set(e.form,"name",a)},expression:"form.name"}})],1)],1),t("a-col",{attrs:{span:6}},[t("a-form-item",{attrs:{label:"类别"}},[t("a-input",{attrs:{placeholder:"如 文化课/语言类"},model:{value:e.form.category,callback:function(a){e.$set(e.form,"category",a)},expression:"form.category"}})],1)],1),t("a-col",{attrs:{span:6}},[t("a-form-item",{attrs:{label:"类型"}},[t("a-select",{model:{value:e.form.type,callback:function(a){e.$set(e.form,"type",a)},expression:"form.type"}},[t("a-select-option",{attrs:{value:"班课"}},[e._v("班课")]),t("a-select-option",{attrs:{value:"一对一"}},[e._v("一对一")])],1)],1)],1)],1),t("a-row",{attrs:{gutter:16}},[t("a-col",{attrs:{span:6}},[t("a-form-item",{attrs:{label:"适合年龄段"}},[t("a-input",{attrs:{placeholder:"如 8-12"},model:{value:e.form.ageRange,callback:function(a){e.$set(e.form,"ageRange",a)},expression:"form.ageRange"}})],1)],1),t("a-col",{attrs:{span:4}},[t("a-form-item",{attrs:{label:"课时数"}},[t("a-input-number",{staticStyle:{width:"100%"},attrs:{min:1},model:{value:e.form.lessonCount,callback:function(a){e.$set(e.form,"lessonCount",a)},expression:"form.lessonCount"}})],1)],1),t("a-col",{attrs:{span:4}},[t("a-form-item",{attrs:{label:"单价"}},[t("a-input-number",{staticStyle:{width:"100%"},attrs:{min:0,step:10},model:{value:e.form.unitPrice,callback:function(a){e.$set(e.form,"unitPrice",a)},expression:"form.unitPrice"}})],1)],1),t("a-col",{attrs:{span:6}},[t("a-form-item",{attrs:{label:"状态"}},[t("a-select",{model:{value:e.form.status,callback:function(a){e.$set(e.form,"status",a)},expression:"form.status"}},[t("a-select-option",{attrs:{value:"draft"}},[e._v("草稿")]),t("a-select-option",{attrs:{value:"published"}},[e._v("已发布")]),t("a-select-option",{attrs:{value:"offline"}},[e._v("已下架")])],1)],1)],1)],1),t("a-row",{attrs:{gutter:16}},[t("a-col",{attrs:{span:12}},[t("a-form-item",{attrs:{label:"课程大纲"}},[t("a-input-textarea",{attrs:{rows:3},model:{value:e.form.outline,callback:function(a){e.$set(e.form,"outline",a)},expression:"form.outline"}})],1)],1),t("a-col",{attrs:{span:12}},[t("a-form-item",{attrs:{label:"教学目标"}},[t("a-input-textarea",{attrs:{rows:3},model:{value:e.form.objective,callback:function(a){e.$set(e.form,"objective",a)},expression:"form.objective"}})],1)],1)],1),t("a-space",[t("a-button",{attrs:{type:"primary"},on:{click:e.saveCourse}},[e._v("保存课程")]),t("a-button",{on:{click:e.resetForm}},[e._v("重置")])],1)],1),t("a-divider"),t("h4",[e._v("课程列表")]),t("a-input-search",{staticStyle:{"max-width":"320px","margin-bottom":"8px"},attrs:{placeholder:"按名称关键字搜索"},on:{search:e.loadCourses},model:{value:e.keyword,callback:function(a){e.keyword=a},expression:"keyword"}}),t("a-table",{attrs:{columns:e.courseColumns,"data-source":e.courses,rowKey:"courseId",pagination:!1},scopedSlots:e._u([{key:"status",fn:function(a){return t("span",{},[e._v(e._s(e.statusText(a)))])}},{key:"actions",fn:function(a,o){return t("span",{},[t("a-space",[t("a",{on:{click:function(n){return e.editCourse(o)}}},[e._v("编辑")]),t("a",{on:{click:function(n){return e.openBindMaterials(o)}}},[e._v("绑定教材")]),t("a-dropdown",[t("a",{staticClass:"ant-dropdown-link"},[e._v("状态"),t("i",{staticClass:"anticon anticon-down"})]),t("a-menu",{attrs:{slot:"overlay"},slot:"overlay"},[t("a-menu-item",{on:{click:function(n){return e.changeStatus(o,"draft")}}},[e._v("草稿")]),t("a-menu-item",{on:{click:function(n){return e.changeStatus(o,"published")}}},[e._v("已发布")]),t("a-menu-item",{on:{click:function(n){return e.changeStatus(o,"offline")}}},[e._v("已下架")])],1)],1)],1)],1)}}])}),t("a-modal",{attrs:{visible:e.bindVisible,title:"绑定教材"},on:{ok:e.doBindMaterials,cancel:function(a){e.bindVisible=!1}}},[t("a-select",{staticStyle:{width:"100%"},attrs:{mode:"multiple",placeholder:"选择教材"},model:{value:e.selectedMaterials,callback:function(a){e.selectedMaterials=a},expression:"selectedMaterials"}},e._l(e.textbooks,function(a){return t("a-select-option",{key:a.textbookId,attrs:{value:a.textbookId}},[e._v(" "+e._s(a.name)+"（¥"+e._s(a.unitPrice)+" | 库存："+e._s(a.stock)+"） ")])}),1)],1)],1)},c=[],u=r(i,l,c,!1,null,"0d865523",null,null);const m=u.exports;export{m as default};
